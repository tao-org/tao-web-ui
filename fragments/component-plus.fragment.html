<div class="modal-content">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="myModalLabel">Create a processing module</h4>
    </div>

    <form id="frmExecNodeEdit" class="form-horizontal form-newpc" role="form">
        <input type="hidden" id="op" name="op" class="op" value="op-plus" />
        <input type="hidden" id="id_u" name="id_u" value="0" />
        <input type="hidden" name="clickedon" value="">

        <div class="modal-error collapse">
            <h4 class="modal-title">Error creating processing module!</h4>
            <p id="modal-error-msg">Please check your data, one or more values for the attributes is not in the acceptable range.</p>
            <p>
                <span class="error-inputCompID collapse"><i class="fa fa-exclamation-triangle fa-fw" aria-hidden="true"></i> ID cannot be empty.</span>
                <span class="error-label collapse"><i class="fa fa-exclamation-triangle fa-fw" aria-hidden="true"></i> Label cannot be empty.</span>
                <span class="error-version collapse"><i class="fa fa-exclamation-triangle fa-fw" aria-hidden="true"></i> Version cannot be empty.</span>
                <span class="error-template collapse"><i class="fa fa-exclamation-triangle fa-fw" aria-hidden="true"></i> Template contents cannot be empty.</span>
                <span class="error-fileLocation collapse"><i class="fa fa-exclamation-triangle fa-fw" aria-hidden="true"></i> File location has an invalid value.</span>
            </p>
            <p id="modal-error-msg-server"></p>
        </div>

        <div class="modal-body">
            <section>
                <div class="row">
                    <div class="col-md-12">
						<p>Please check all the tabs before saving a new processing module.</p>
						<ul class="nav nav-tabs">
							<li class="active"><a data-toggle="tab" href="#comp-tab-gd">General desc.</a></li>
							<li><a data-toggle="tab" href="#comp-tab-conf">Configuration</a></li>
							<li><a data-toggle="tab" href="#comp-tab-param">Parameters</a></li>
							<li><a data-toggle="tab" href="#comp-tab-sys">Sys. vars.</a></li>
							<li><a data-toggle="tab" href="#comp-tab-ports">Sources & Targets</a></li>
						</ul>
						<div class="tab-content">
							<div id="comp-tab-gd" class="tab-pane fade in active padding-top--20 padding-left--20 padding-bottom--20">
								<div class="row">
									<div class="col-md-12">
										<div class="form-group has-feedback">
											<label for="inputCompID" class="col-sm-2 col-md-2 control-label">ID</label>
											<div class="col-sm-10 col-md-10">
												<input type="text" class="form-control" id="inputCompID" name="inputCompID" placeholder="component ID" autocomplete="off" value=""/>
												<span class="ckattr-ok glyphicon glyphicon-ok form-control-feedback collapse" aria-hidden="true"></span>
												<span class="ckattr-ok sr-only collapse">(success)</span>
												<span class="ckattr-error glyphicon glyphicon-remove form-control-feedback collapse" aria-hidden="true"></span>
												<span class="ckattr-error sr-only collapse">(error)</span>
												<span style="font-style: italic;font-size: 1.3rem;" id="helpId">ID must be <b>unique </b>and can contain letters (a-z) (A-Z), numbers (0-9), periods (.), dashes (-), and underscores (_)</span>
											</div>
										</div>
									</div>
								</div>
								<div class="row">
									<div class="col-md-12">
										<div class="form-group">
											<label for="inputCompLabel" class="col-sm-2 col-md-2 control-label">Label</label>
											<div class="col-sm-10 col-md-10">
												<input type="text" class="form-control" id="inputCompLabel" name="inputCompLabel" placeholder="component label" autocomplete="off" value="" data-errorspan="label"/>
											</div>
										</div>
									</div>
								</div>
								<div class="row">
									<div class="col-md-12">
										<div class="form-group">
											<label for="inputCompVersion" class="col-sm-2 col-md-2 control-label">Version</label>
											<div class="col-sm-10 col-md-10">
												<input type="text" class="form-control" id="inputCompVersion" name="inputCompVersion" placeholder="1.0.0" autocomplete="off" value="" data-errorspan="version"/>
											</div>
										</div>
									</div>
								</div>
								<div class="row">
									<div class="col-md-12">
										<div class="form-group">
											<label for="inputCompDescription" class="col-sm-2 col-md-2 control-label">Description </label>
											<div class="col-sm-10 col-md-10">
												<textarea class="form-control" rows="3" id="inputCompDescription" name="inputCompDescription" placeholder="Short description about this processing module"></textarea>
											</div>
										</div>
									</div>
								</div>
								<div class="row">
									<div class="col-md-12">
										<div class="form-group">
											<label for="inputCompAuthors" class="col-sm-2 col-md-2 control-label">Author </label>
											<div class="col-sm-10 col-md-10">
												<input type="text" class="form-control" id="inputCompAuthors" name="inputCompAuthors" placeholder="John Doe" autocomplete="off" value="" data-errorspan="memorySize"/>
											</div>
										</div>
									</div>
								</div>
								<div class="row">
									<div class="col-md-12">
										<div class="form-group">
											<label for="inputCompCopyright" class="col-sm-2 col-md-2 control-label">Copyright </label>
											<div class="col-sm-10 col-md-10">
												<input type="text" class="form-control" id="inputCompCopyright" name="inputCompCopyright" placeholder="(C) IT GROUP " autocomplete="off" value="" data-errorspan="memorySize"/>
											</div>
										</div>
									</div>
								</div>
								<div class="row">
									<div class="col-md-12">
										<div class="form-group">
											<label for="inputActive" class="col-sm-2 col-md-2 control-label">Status </label>
											<div class="col-sm-10 col-md-10">
												<select disabled="disabled" id="inputActive" name="inputActive" class="form-control">
													<option value="true" selected="">Active</option>
													<option value="false">Inactive</option>
												</select>
											</div>
										</div>
									</div>
								</div>
								<div class="row">
									<div class="col-md-12">
										<div class="form-group">
											<label for="inputVisibility" class="col-sm-2 col-md-2 control-label">Visibility </label>
											<div class="col-sm-10 col-md-10">
												<select disabled="disabled" id="inputVisibility" name="inputVisibility" class="form-control">
													<option value="SYSTEM">System</option>
													<option value="USER">User</option>
													<option value="CONTRIBUTOR" selected="selected">Contributor</option>
												</select>
											</div>
										</div>
									</div>
								</div>
								<div class="row">
									<div class="col-md-12">
										<div class="form-group">
											<label for="inputTemplateType" class="col-sm-2 col-md-2 control-label">Template Type </label>
											<div class="col-sm-10 col-md-10">
												<select id="inputTemplateType" name="inputTemplateType" class="form-control">
													<option value="VELOCITY" selected="selected">Apache Velocity</option>
													<option value="JAVASCRIPT" >Javascript</option>
													<option value="XSLT">XSLT</option>
												</select>
											</div>
										</div>
									</div>
								</div> <div class="row">
									<div class="col-md-12">
										<div class="form-group">
											<label for="inputComponentType" class="col-sm-2 col-md-2 control-label">Component Type </label>
											<div class="col-sm-10 col-md-10">
												<select id="inputComponentType" name="inputComponentType" class="form-control">
													<option value="EXECUTABLE" selected="selected">Executable</option>
													<option value="SCRIPT" >Script</option>                                                       
												</select>
											</div>
										</div>
									</div>
								</div>
								<div class="row">
									<div class="col-md-12">
										<div class="form-group">
											<label for="inputComponentCategory" class="col-sm-2 col-md-2 control-label">Component Category </label>
											<div class="col-sm-10 col-md-10">
												<select id="inputComponentCategory" name="inputComponentCategory" class="form-control"></select>
											</div>
										</div>
									</div>
								</div>
								<div class="row">
									<div class="col-md-12">
										<div class="form-group">
											<label for="inputCompParallelism" class="col-sm-2 col-md-2 control-label">Parallelism </label>
											<div class="col-sm-10 col-md-10">
												<input type="number" min="1" step="1" class="form-control" id="inputCompParallelism" name="inputCompParallelism" placeholder="component parallelism" autocomplete="off" value="1" data-errorspan="parallelism" />
											</div>
										</div>
									</div>
								</div>
								<div class="row">
									<div class="col-md-12">
										<div class="form-group">
											<label for="formTags" class="col-sm-2 col-md-2 control-label">Tags </label>
											<div class="col-sm-10 col-md-10">
												<input id="formTags" name="formTags" class="form-control" value="">
											</div>
										</div>
									</div>
								</div>
							</div>
							<div id="comp-tab-conf" class="tab-pane fade padding-top--20 padding-left--20 padding-bottom--20">

								<div class="row">
									<div class="col-md-12">
										<div class="form-group">
											<label for="inputContainerId" class="col-sm-2 col-md-2 control-label">Container </label>
											<div class="col-sm-10 col-md-10">
												<select id="inputContainerId" name="inputContainerId" class="form-control">
													<option class="default-container" disabled selected>Select container...</option>
												</select>
											</div>
										</div>
									</div>
								</div>
								<div class="row">
									<div class="col-md-12">
										<div class="form-group">
											<label for="inputFileLocation" class="col-sm-2 col-md-2 control-label">File location </label>
											<div class="col-sm-10 col-md-10">
												<select type="text" class="form-control" id="inputFileLocation" name="inputFileLocation" placeholder="file location" data-errorspan="fileLocation" autocomplete="off" value="">
													<option class="default-file" disabled selected>Select file location...</option>
												</select>
											</div>
										</div>
									</div>
								</div>
								<div class="row">
									<div class="col-md-12">
										<div class="form-group">
											<label for="inputWorkingDirectory" class="col-sm-2 col-md-2 control-label">Working directory </label>
											<div class="col-sm-10 col-md-10">
												<input type="text" class="form-control" id="inputWorkingDirectory" name="inputWorkingDirectory" placeholder="working directory" autocomplete="off" value=".\mypath1"/>
											</div>
										</div>
									</div>
								</div>
								<!-- velocity template form-->
								<div class="template-block-frm">
									<div class="row">
										<div class="col-md-12">
											<div class="form-group" id="ace-css">
												<label for="inputTemplateContents" class="col-sm-2 col-md-2 control-label" style="padding-right: 30px">Template contents</label>
												<div class="col-sm-10 col-md-10" id="ace-editor">
													<textarea class="form-control" rows="8" id="inputTemplateContents" name="inputTemplateContents" placeholder="template contents" data-errorspan="template"></textarea>
												</div>
											</div>
											<div class="form-group">
												<div class="col-md-offset-2 col-md-10 col-sm-offset-2 col-sm-10">
													<button id="openJupyterLab" type="button" class="btn btn-primary btn-submit hidden" name="btnOpenJupyterLab">Open JupyterLab</button>
												</div>
											</div>
										</div>
									</div>
								</div>

							</div>
							<div id="comp-tab-param" class="tab-pane fade padding-top--20 padding-bottom--20">
								<div class="row">
									<div class="col-md-12">
										<div class="responsive" style="overflow: auto;">
											<table class="table table-bordered box-shadow--6dp tbl-edt" id="tbl-edt-paramdesc">
												<thead>
												<tr>
													<th></th>
													<th>Name</th>
													<th>Description</th>
													<th>Parameter Label</th>
													<th>Parameter Type</th>
													<th>Data Type</th>
													<th>Default value</th>
												</tr>
												</thead>
												<tfoot>
												<tr>
													<td colspan="3">
														<button type="button" class="btn btn-primary btn-sm btn-flat btn-action btn-comp-addnewparam" data-action="comp-add-new-var">
															<i class="fa fa-plus fa-fw" aria-hidden="true"></i><span class="span-muted collapse">&nbsp;Add new variable</span>
														</button>
													</td>
												</tr>
												</tfoot>


												<tbody class="tpl-sample-body">
												<tr class="tpl-sample-row">
													<th scope="row">
														<a href="#" class="text tbl-prop-expand-action"><i class="fa fa-pencil fa-fw" aria-hidden="true"></i></a>
														<i class="fa fa-plus fa-fw hidden" aria-hidden="true"></i>
														<a href="#" class="text tbl-prop-delete-action"><i class="fa fa-trash-o fa-fw" aria-hidden="true"></i></a>
													</th>
													<td>
														<input type="hidden" class="var-id" value="">
														<input type="text" class="var-name" value="" placeholder="parameter name">
													</td>
													<td><textarea rows="2" class="var-description"></textarea></td>
													<td>
														<input type="text" class="var-label" value="" placeholder="parameter label">
													</td>
													<td>
														<select class="var-type">
															<option value="REGULAR" selected="selected">Regular</option>
															<option value="TEMPLATE">Template</option>
														</select>
													</td>
													<td>
														<select class="var-datatype select-datatypes"></select>
													</td>
													<td>
														<div>
															<input type="text" class="var-default" value="" placeholder="">
														</div>
													</td>
												</tr>
												<tr style="display: none;" class="val-row-plus">
													<td colspan="7">
														<div class="row">
															<div class="col-md-12">
																<div class="form-group">
																	<label class="col-sm-2 col-md-2 control-label">Unit</label>
																	<div class="col-sm-10 col-md-10">
																		<input type="text" class="form-control var-unit" name="inputUnit" placeholder="unit" autocomplete="off" value=""/>
																	</div>
																</div>
															</div>
															<div class="col-md-12">
																<div class="form-group">
																	<label class="col-sm-2 col-md-2 control-label">Value Set</label>
																	<div class="col-sm-10 col-md-10">
																		<input type="text" class="form-control var-valueset" name="inputValueSet" placeholder="value set" autocomplete="off" value=""/>
																	</div>
																</div>
															</div>
															<div class="col-md-12">
																<div class="form-group">
																	<label class="col-sm-2 col-md-2 control-label">Format</label>
																	<div class="col-sm-10 col-md-10">
																		<input type="text" class="form-control var-format" name="inputFormat" placeholder="format" autocomplete="off" value=""/>
																	</div>
																</div>
															</div>
															<div class="col-md-12">
																<div class="form-group">
																	<label class="col-sm-2 col-md-2 control-label">Not Null </label>
																	<div class="col-sm-10 col-md-10">
																		<div class="checkbox">
																			<input type="checkbox" name="inputNotNull" class="big var-notnull">
																		</div>
																	</div>
																</div>
															</div>
															<div class="col-md-12 col-er-joinvalues">
																<div class="form-group">
																	<label class="col-sm-2 col-md-2 control-label">Join Values </label>
																	<div class="col-sm-10 col-md-10">
																		<div class="checkbox">
																			<input type="checkbox" name="joinValues" class="big var-er-joinvalues">
																			<input type="hidden" name="id" class="big var-er-id">
																		</div>
																	</div>
																</div>
															</div>
															<div class="col-md-12 col-er-separator collapse">
																<div class="form-group">
																	<label class="col-sm-2 col-md-2 control-label">Separator</label>
																	<div class="col-sm-10 col-md-10">
																		<input type="text" class="form-control var-er-separator" name="separator" placeholder="separator" autocomplete="off" value=""/>
																	</div>
																</div>
															</div>
															<div class="col-md-12">
																<div class="form-group">
																	<label class="col-sm-2 col-md-2 control-label">Validator </label>
																	<div class="col-sm-10 col-md-10">
																		<input type="text" class="form-control var-validator" name="inputValidator" placeholder="validator" autocomplete="off" value=""/>
																	</div>
																</div>
															</div>
															<div class="col-md-12">
																<div class="temp-table">
																	<label class="col-sm-1 col-md-1 control-label">Parameters</label>
																	<table class="table table-bordered box-shadow--6dp tbl-edt-template-params">
																		<thead>
																			<tr>
																				<th></th>
																				<th>Name</th>
																				<th>Description</th>
																				<th>Parameter Label</th>
																				<th>Parameter Type</th>
																				<th>Data Type</th>
																				<th>Default value</th>
																			</tr>
																			</thead>
																			<tfoot>
																			<tr>
																				<td colspan="3">
																					<button type="button" class="btn btn-primary btn-sm btn-flat btn-action btn-comp-addnewparam-temp" data-action="comp-add-new-var">
																						<i class="fa fa-plus fa-fw" aria-hidden="true"></i><span class="span-muted collapse">&nbsp;Add new variable</span>
																					</button>
																				</td>
																			</tr>
																			</tfoot>
							
							
																			<tbody class="tpl-sample-body-temp">
																			<tr class="tpl-sample-row-temp">
																				<th scope="row">
																					<a href="#" class="text tbl-prop-expand-action-temp"><i class="fa fa-pencil fa-fw" aria-hidden="true"></i></a>
																					<i class="fa fa-plus fa-fw hidden" aria-hidden="true"></i>
																					<a href="#" class="text tbl-prop-delete-action-temp"><i class="fa fa-trash-o fa-fw" aria-hidden="true"></i></a>
																				</th>
																				<td>
																					<input type="hidden" class="var-id-temp" value="">
																					<input type="text" class="var-name-temp" value="" placeholder="parameter name">
																				</td>
																				<td><textarea rows="2" class="var-description-temp"></textarea></td>
																				<td>
																					<input type="text" class="var-label-temp" value="" placeholder="parameter label">
																				</td>
																				<td>
																					<textarea rows="2" class="var-type-temp" value="REGULAR" readonly>REGULAR</textarea></td>
																				</td>
																				<td>
																					<select class="var-datatype-temp select-datatypes-temp"></select>
																				</td>
																				<td>
																					<div>
																						<input type="text" class="var-default-temp" value="" placeholder="">
																					</div>
																				</td>
																			</tr>
																			<tr style="display: none;" class="val-row-plus-temp">
																				<td colspan="7">
																					<div class="row">
																						<div class="col-md-12">
																							<div class="form-group">
																								<label class="col-sm-2 col-md-2 control-label">Unit</label>
																								<div class="col-sm-10 col-md-10">
																									<input type="text" class="form-control var-unit-temp" name="inputUnit" placeholder="unit" autocomplete="off" value=""/>
																								</div>
																							</div>
																						</div>
																						<div class="col-md-12">
																							<div class="form-group">
																								<label class="col-sm-2 col-md-2 control-label">Value Set</label>
																								<div class="col-sm-10 col-md-10">
																									<input type="text" class="form-control var-valueset-temp" name="inputValueSet" placeholder="value set" autocomplete="off" value=""/>
																								</div>
																							</div>
																						</div>
																						<div class="col-md-12">
																							<div class="form-group">
																								<label class="col-sm-2 col-md-2 control-label">Format</label>
																								<div class="col-sm-10 col-md-10">
																									<input type="text" class="form-control var-format-temp" name="inputFormat" placeholder="format" autocomplete="off" value=""/>
																								</div>
																							</div>
																						</div>
																						<div class="col-md-12">
																							<div class="form-group">
																								<label class="col-sm-2 col-md-2 control-label">Not Null </label>
																								<div class="col-sm-10 col-md-10">
																									<div class="checkbox">
																										<input type="checkbox" name="inputNotNull" class="big var-notnull-temp">
																									</div>
																								</div>
																							</div>
																						</div>
																						<div class="col-md-12 col-er-joinvalues-temp">
																							<div class="form-group">
																								<label class="col-sm-2 col-md-2 control-label">Join Values </label>
																								<div class="col-sm-10 col-md-10">
																									<div class="checkbox">
																										<input type="checkbox" name="joinValues" class="big var-er-joinvalues-temp">
																										<input type="hidden" name="id" class="big var-er-id-temp">
																									</div>
																								</div>
																							</div>
																						</div>
																						<div class="col-md-12 col-er-separator-temp collapse">
																							<div class="form-group">
																								<label class="col-sm-2 col-md-2 control-label">Separator</label>
																								<div class="col-sm-10 col-md-10">
																									<input type="text" class="form-control var-er-separator-temp" name="separator" placeholder="separator" autocomplete="off" value=""/>
																								</div>
																							</div>
																						</div>
																						<div class="col-md-12">
																							<div class="form-group">
																								<label class="col-sm-2 col-md-2 control-label">Validator </label>
																								<div class="col-sm-10 col-md-10">
																									<input type="text" class="form-control var-validator-temp" name="inputValidator" placeholder="validator" autocomplete="off" value=""/>
																								</div>
																							</div>
																						</div>
																					</div>
																				</td>
																			</tr>
																		</tbody>
																	</table>
																</div>
															</div>
														</div>
													</td>
												</tr>
												</tbody>
											</table>
										</div>
									</div>
								</div>
							</div>
							<div id="comp-tab-sys" class="tab-pane padding-top--20 fade">
								<div class="row">
									<div class="col-md-12">
										<div class="responsive">
											<table class="table table-bordered box-shadow--6dp tbl-edt" id="tbl-edt-sysvar">
												<thead>
												<tr>
													<th></th>
													<th>Key</th>
													<th>Value</th>
												</tr>
												</thead>
												<tfoot>
												<tr>
													<td colspan="3">
														<button type="button" class="btn btn-primary btn-sm btn-flat btn-action btn-comp-addnewvar" data-action="comp-add-new-var">
															<i class="fa fa-plus fa-fw" aria-hidden="true"></i><span class="span-muted collapse">&nbsp;Add new variable</span>
														</button>
													</td>
												</tr>
												</tfoot>
												<tbody>
												<tr class="tpl-sample-row">
													<th class="del-col" scope="row">
														<a href="#" class="text tbl-sysvar-delete-action"><i class="fa fa-trash-o fa-fw" aria-hidden="true"></i></a>
													</th>
													<td><input type="text" class="var-key" value="" placeholder="input variable's name"></td>
													<td><input type="text" class="var-value" value="" placeholder="input variable's value"></td>
												</tr>
												</tbody>
											</table>
										</div>
									</div>
								</div>
							</div>
							<div id="comp-tab-ports" class="tab-pane padding-top--20 fade">
								<div class="row">
									<div class="col-md-12">
										<div class="responsive box-shadow--6dp" style="margin-bottom:20px;overflow:auto">
											<table class="table table-bordered tbl-edt" id="tbl-edt-sources" style="margin:0">
												<thead>
												<tr><th colspan="9" class="table-title">Sources</th></tr>
												<tr>
													<th></th>
													<th>Source Name</th>
													<th>Format Type</th>
													<th>Geometry</th>
													<th>CRS</th>
													<th>Sensor Type</th>
													<th>Dimension</th>
													<th>Cardinality<br><i>(0 for list)</i></th>
													<th></th> <!--empty header row used for more icon -->
												</tr>
												</thead>
												<tfoot>
												<tr>
													<td colspan="2">
														<button type="button" class="btn btn-primary btn-sm btn-flat btn-action btn-comp-addnewsrc" data-action="comp-add-new-var">
															<i class="fa fa-plus fa-fw" aria-hidden="true"></i><span class="span-muted collapse">&nbsp;Add new variable</span>
														</button>
													</td>
												</tr>
												</tfoot>
												<tbody class="tpl-sample-body">
												<tr class="tpl-sample-row">
													<th scope="row">
														<a href="#" class="text tbl-port-delete-action"><i class="fa fa-trash-o fa-fw" aria-hidden="true"></i></a>
													</th>
													<td>
														<input type="hidden" class="var-id" value="">
														<input type="text" class="var-name" value="" placeholder="Source name">
													</td>
													<td><select class="var-formatType empty"></select></td>
													<td><textarea rows="1" class="var-geometry"></textarea></td>
													<td><input type="text" class="var-crs" value=""></td>
													<td><select class="var-sensorType empty"></select></td>
													<td><input type="text" class="var-dimension" value=""></td>
													<td><input type="number" class="var-cardinality" value="0" style="width:40px;text-align:left"></td>
													<td><button type="button" name="more"><i class="fa fa-ellipsis-h"></i></button></td>
												</tr>
												</tbody>
											</table>
										</div>
										<div class="responsive box-shadow--6dp" style="margin-bottom:20px;overflow:auto">
											<table class="table table-bordered tbl-edt" id="tbl-edt-targets" style="margin:0">
												<thead>
												<tr><th colspan="9" class="table-title">Targets</th></tr>
												<tr>
													<th></th>
													<th>Target Name</th>
													<th>Format Type</th>
													<th>Format Name</th>
													<th>Default Value</th>
													<th>Sensor Type</th>
													<th>Dimension</th>
													<th>Cardinality<br><i>(0 for list)</i></th>
													<th></th> <!--empty header row used for more icon -->
												</tr>
												</thead>
												<tfoot>
												<tr>
													<td colspan="2">
														<button type="button" class="btn btn-primary btn-sm btn-flat btn-action btn-comp-addnewtrgt" data-action="comp-add-new-var">
															<i class="fa fa-plus fa-fw" aria-hidden="true"></i><span class="span-muted collapse">&nbsp;Add new variable</span>
														</button>
													</td>
												</tr>
												</tfoot>
												<tbody class="tpl-sample-body">
												<tr class="tpl-sample-row">
													<th scope="row">
														<a href="#" class="text tbl-port-delete-action"><i class="fa fa-trash-o fa-fw" aria-hidden="true"></i></a>
													</th>
													<td>
														<input type="hidden" class="var-id" value="">
														<input type="text" class="var-name" value="" placeholder="Target name">
													</td>
													<td><select class="var-formatType empty"></select></td>
													<td><select class="var-formatName empty"></select></td>
													<td><input type="text" class="var-location" value=""></td>
													<td><select class="var-sensorType empty"></select></td>
													<td><input type="text" class="var-dimension" value=""></td>
													<td><input type="number" class="var-cardinality" value="0" style="width:40px;text-align:left"></td>
													<td><button type="button" name="more"><i class="fa fa-ellipsis-h"></i></button></td>
												</tr>
												</tbody>
											</table>
										</div>

										<div class="col-md-12">
											<div class="col-md-8">
												<input class="larger-text-size" type="checkbox" id="managedOutput" name="managedOutput" checked>
												<label class="larger-text-size" style="color:#000000">Output managed by AVL</label>
												<label style="font-style: italic">(Uncheck this if this component handles the output name by itself)</label>
											</div>
										</div>

										<div id="moreDialog" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="moreDialogModalLabel" aria-hidden="true">
											<div class="modal-dialog">
												<div class="modal-content">
													<div class="modal-header">
														<button type="button" class="close close-modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
														<h4 class="modal-title" id="moreDialogModalLabel">Create a processing module</h4>
													</div>
													<div class="modal-body">
														<section>
															<div class="responsive">
																<table class="table table-bordered box-shadow--6dp tbl-edt" id="tbl-edt-ports-contraints">
																	<thead>
																		<tr>
																			<th></th>
																			<th>Key</th>
																			<th>Value</th>
																		</tr>
																	</thead>
																	<tfoot>
																		<tr>
																			<td colspan="3">
																				<button type="button" class="btn btn-primary btn-sm btn-flat btn-action btn-ports-addnewconstraint" data-action="ports-add-new-constraint">
																					<i class="fa fa-plus fa-fw" aria-hidden="true"></i><span class="span-muted collapse">&nbsp;Add new variable</span>
																				</button>
																			</td>
																		</tr>
																	</tfoot>
																	<tbody>
																		<tr class="tpl-sample-row">
																			<th class="del-col" scope="row">
																				<a href="#" class="text tbl-sysvar-delete-action"><i class="fa fa-trash-o fa-fw" aria-hidden="true"></i></a>
																			</th>
																			<td><input type="text" class="var-key" value="" placeholder="input variable's name"></td>
																			<td><input type="text" class="var-value" value="" placeholder="input variable's value"></td>
																		</tr>
																	</tbody>
																</table>
															</div>
														</section>
													</div>
													<div class="modal-footer">
														<!--<button id="doneModifConstraints" type="button" class="btn btn-primary btn-submit left-btn" name="btnDone">Done</button>-->
														<button type="button" class="btn btn-default close-modal">Close</button>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group">
                            <div class="col-md-offset-1 col-md-11 col-sm-offset-1 col-sm-11">
								<div class="modal-footer">
									<button id="saveExecNode" type="submit" class="btn btn-primary btn-submit left-btn" name="btnSave">Create a processing module</button>
									<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
								</div>
							</div>
                        </div>
                    </div>
                </div>
            </section>
        </div><!-- /.modal-body -->
    </form>
</div><!-- /.modal-content -->

<!-- Specific styles -->
<style>
#comp-tab-ports thead th{vertical-align:middle}
#comp-tab-ports .tbl-edt input[type="number"]{
	width: 100%;
	padding-left: 0.3em;
	border: 1px solid #FFF;
	-webkit-transition: .18s ease-out;
	-moz-transition: .18s ease-out;
	-o-transition: .18s ease-out;
	transition: .18s ease-out;
}
#comp-tab-ports .tbl-edt input[type="text"]:hover,
#comp-tab-ports .tbl-edt input[type="number"]:hover,
#comp-tab-ports .tbl-edt textarea:hover,
#comp-tab-ports .tbl-edt select:hover{border-color: #d0d0d0}
#comp-tab-ports .tbl-edt button[name='more']{background:none;border:none;color:#3c8dbc;}

.table>tbody+tbody{border:0}
.table select.empty{color:#999;font-style:italic}
.table select.empty>option{color:black;font-style:normal}
.table select>option.ital{color:#999;font-style:italic}
.btn-padding{padding-top: 2px; padding-bottom: 2px;}

.tpl-sample-row-temp{display: none;}
/********************/
form .taginput .tag{background-color:#f0f0f0; border:1px solid #dedede; color: black;}
@media (min-width: 992px) {
	.modal-lg { width: 60%; }
}

textarea {resize: none;}
#ace-css{ margin-left: 6px; margin-right: 0px;}

</style>

   <link rel="stylesheet" href="./assets/libs/jQuery-tags-input-autocomplete/jquery.tagsinput-revisited.css" type="text/css" />
   <script src="./assets/libs/jQuery-tags-input-autocomplete/jquery.tagsinput-revisited.js" type="text/javascript"></script>
   <!-- 1.12.1/jquery-ui.min.js for autocomplete -->
   <link rel="stylesheet" href="./assets/libs/jQuery-datepicker/jquery-ui.css" type="text/css" />
   <script src="./assets/libs/jQuery-datepicker/jquery-ui.js" type="text/javascript"></script>

<script>
	var editor = ace.edit("ace-editor");
	editor.setValue("");
	editor.setOptions({
		fontFamily: "monospace",
		fontSize:"12px",
    	maxLines: 30,
		minLines: 15
	});
	editor.$blockScrolling = Infinity;
	editor.setShowPrintMargin(false);
	
	switch(window.themeParameters.size){
		case 'size-normal':
			editor.setFontSize(14);
			break;
		case 'size-large':
			editor.setFontSize(16);
			break;
		case 'size-larger':
			editor.setFontSize(18);
			break;
	}

    var action = 'op-plus';
	var jupyterContainerId = null;
	
	function fieldFormat(){

		$(".tag-format", "#tbl-edt-paramdesc").tagsInput({
			minChars	: 0,
			maxChars	: null,
			limit		: null,
			interactive	: true,
			autocomplete: null,
			unique		: true,
			placeholder	: 'Add an element',
			delimiter	: ','

		});

		var datepickTagInput = $(".datepicker").siblings(".tagsinput").find("input");
		$("#" + $.datepicker.dpDiv.attr("id")).remove();
		$(".datepicker:not(.tag-format)").datepicker({
			dateFormat: "yy-mm-dd",

		});
		datepickTagInput.datepicker({
			dateFormat: "yy-mm-dd",
			onSelect: function (date){
				$(this).closest("td").find(".tag-format").addTag(date);
			}
		});


	}

	function getTaoEnumsArray(name) {
		var retVal = [];
		$.each(taoEnums.data, function (index, enm) {
			if (index.toLowerCase().indexOf(name.toLowerCase()) >= 0) {
				$.each(enm, function (idx, values) {
					retVal.push(values.key);
				});
			}
		});
		return retVal;
	}

	// Get component specific values for enum type parameters
	var sourceTargetSpecificFormats = {};
	// get format type all possible values
	sourceTargetSpecificFormats["formatType"] = getTaoEnumsArray("DataFormat");
	// set format name list as empty
	sourceTargetSpecificFormats["formatName"] = [];
	// get sensor type all possible values
	sourceTargetSpecificFormats["sensorType"] = getTaoEnumsArray("SensorType");
    
	function getComponentDataById(compID){
        $.ajax({
            cache: false,
            type: "get",
            //url: baseRestApiURL + "component/"+compID+"/",
			url: baseRestApiURL + "component/list?id="+compID,
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            headers: {
                "Accept": "application/json",
                "Content-Type": "application/json",
                "X-Auth-Token": window.tokenKey
            },
            error : function (jqXHR, textStatus, errorThrown) {
                if( jqXHR.status === 500 ){
                    alert('E001, Exec node nolonger found.');
                } else {
                    alert('E001 gcid, An error has occurred, please try again or contact app admin.');
                }
            },
            success: function(r) {
                var response = chkTSRF(r);
				
				//data is returned as an array (edit)
				response = response[0];

				//populate form with current values
				var $el = $('#frmExecNodeEdit');
				$('input[name=inputCompID]', $el).val(response.id);
				$('input[name=inputCompLabel]', $el).val(response.label);
				$('input[name=inputCompVersion]', $el).val(response.version);
				$('textarea[name=inputCompDescription]', $el).val(response.description);
				$('input[name=inputCompAuthors]', $el).val(response.authors);
				$('input[name=inputCompCopyright]', $el).val(response.copyright);
				$('input[name=inputCompLabel]', $el).val(response.label);

				$('select[name=inputActive] option', $el).removeAttr("selected");
				$('select[name=inputActive] option[value="'+response.active+'"]', $el).attr("selected", "selected");

				$('select[name=inputVisibility] option', $el).removeAttr("selected");
				$('select[name=inputVisibility] option[value="'+response.visibility+'"]', $el).prop("selected", true);
				$("#inputVisibility").removeAttr("disabled");

				$('select[name=inputTemplateType] option', $el).removeAttr("selected");
				$('select[name=inputTemplateType] option[value="'+response.templateType+'"]', $el).attr("selected", "selected");

				$('select[name=inputContainerId] option', $el).removeAttr("selected");
				$('select[name=inputContainerId] option[value="'+response.containerId+'"]', $el).attr("selected", "selected");
				$('select[name=inputContainerId]').trigger("change");

				// var found = $("#inputFileLocation option").filter(function(index) { return $(this).data().name === response.id; })
				// if(found.length === 1){
				// 	$("#inputFileLocation option").filter(function(index) { return $(this).text() === response.id; }).attr('selected', 'selected');
				// }else{
					$('select[name=inputFileLocation] option[value="'+response.fileLocation+'"]', $el).attr("selected", "selected");
				// }
				
				$('input[name=inputWorkingDirectory]', $el).val(response.workingDirectory);

				if( response.componentType === "SCRIPT" && ($("#inputContainerId").find("option:selected").text()).startsWith("python")){
					$("#openJupyterLab").removeClass("hidden");
					editor.getSession().setMode("ace/mode/python");
					editor.setTheme("ace/theme/crimson_editor");
				}else{
					if(response.templateType === "XSLT"){
						editor.getSession().setMode("ace/mode/xml");
					}else{
						editor.getSession().setMode("ace/mode/"+response.templateType.toLowerCase());
					}
				}
				editor.getSession().setValue(response.templatecontents);

				$('select[name=inputComponentType] option', $el).removeAttr("selected");
				var componentType = typeof(response.componentType) === 'undefined'? 'EXECUTABLE' : response.componentType;
				$('select[name=inputComponentType] option[value="'+componentType+'"]', $el).attr("selected", "selected");
				
				$('select[name=inputComponentCategory] option', $el).removeAttr("selected");
				$('select[name=inputComponentCategory] option[value="'+response.category+'"]', $el).attr("selected", "selected");
				
				$('input[name=inputCompParallelism]', $el).val(response.parallelism);

				//////////////
				$('input[name=managedOutput]', $el).prop({ "checked": response.managedOutput });
				
				if((typeof response.tags !== 'undefined') && response.tags != null && response.tags !== ""){
					$('#formTags').importTags( response.tags.join());
				}
				
				$.each(response.variables, function(i, value) {
					helper_addSysVarRow($("#tbl-edt-sysvar"), value);
				});
                $.each(response.parameterDescriptors, function(i, value) {
                    helper_addParameterDescriptorsRow($("#tbl-edt-paramdesc"), value);
                });
				
				// get format name all possible values
				$.ajax({
					url        : baseRestApiURL + "docker/formats?containerId=" + response.containerId,
					type       : "get",
					dataType   : "json",
					async      : false,
					contentType: "application/json; charset=utf-8",
					headers    : { "Accept": "application/json", "Content-Type": "application/json", "X-Auth-Token": window.tokenKey },
					success: function(rsData) {
						sourceTargetSpecificFormats["formatName"] = chkTSRF(rsData);
					}
				});
				
				$.each(response.sources, function(i, value) {
                    helper_addSourceTargetDescriptorsRow($("#tbl-edt-sources"), value, sourceTargetSpecificFormats);
                });
                $.each(response.targets, function(i, value) {
					helper_addSourceTargetDescriptorsRow($("#tbl-edt-targets"), value, sourceTargetSpecificFormats);
                });

				fieldFormat();
            }
        });
        return true;
    }

    function helper_addSourceTargetDescriptorsRow($tbl, payload, specificFormats){
		var obj = {
			"id": null,
			"parentId": null,
			"name": null,
			"formatType": null,
			"formatName": null,
			"location": null,
			"constraints": null
		};
		
		var $el = $tbl.find(".tpl-sample-body").clone().removeClass("tpl-sample-body");
		var $sRow = $el.find(".tpl-sample-row");
		
        if (isOldVersion) {
			if (typeof payload !== "undefined") {
				$.each(payload.dataDescriptor, function(k, v) {
					payload[k] = v;
				});
				delete payload["dataDescriptor"];
			} else {
				obj["geometry"] = null;
				obj["crs"] = null;
				obj["sensorType"] = null;
				obj["dimension"] = null;
			}
		} else {
			obj["attributes"] = null;
			
			$tbl.find("thead th:contains('Geometry')").remove();
			$tbl.find("thead th:contains('CRS')").remove();
			$tbl.find("thead th:contains('Dimension')").remove();
			$tbl.find("thead th:contains('Sensor Type')").remove();
			
			$('textarea.var-geometry', $sRow).closest("td").remove();
			$('input.var-crs', $sRow).closest("td").remove();
			$('select.var-sensorType', $sRow).closest("td").remove();
			$('input.var-dimension', $sRow).closest("td").remove();
		}
        $.extend( obj, payload );
		
		// Populate all combo-boxes with descriptor formats
		if (typeof specificFormats !== "undefined") {
			$.each(specificFormats, function (index, options) {
				if ($(".var-"+index, $sRow).is("select")) {
					if (options.length > 0) {
						// formatType parameter is mandatory
						if (index.toLowerCase() == "formattype") {
							$(".var-"+index, $sRow).removeClass("empty");
						} else {
							$(".var-"+index, $sRow).html("<option class='ital' value><i>Select...</i></option>");
						}
						$.each(options, function (idx, option) {
							$(".var-"+index, $sRow).append('<option value="'+option+'">'+option+'</option>');
						});
					} else {
						$(".var-"+index, $sRow).parent().append('<div style="text-align: center">-</div>');
						$(".var-"+index, $sRow).remove();
					}
				}
			});
		}
		$el.find(".tpl-sample-row").addClass("val-row").removeClass("tpl-sample-row");
        
		$('input.var-id', $sRow).val(obj.id);
		$('input.var-name', $sRow).val(obj.name);
        $('select.var-formatType option', $sRow).removeAttr("selected");
        $('select.var-formatType option[value="'+obj.formatType+'"]', $sRow).attr("selected", "selected").closest("select").removeClass("empty");
        $('select.var-formatName option', $sRow).removeAttr("selected");
		$('select.var-formatName option[value="' + obj.formatName + '"]', $sRow).attr("selected", "selected").closest("select").removeClass("empty");
		if ($tbl.attr("id") === "tbl-edt-targets") {
			$('input.var-location', $el).val(obj.location);
		} else {
			if (isOldVersion) {
				$('textarea.var-geometry', $el).val(obj.geometry);
				$('input.var-crs', $el).val(obj.crs);
			}
        }
        if (isOldVersion) {
			$('select.var-sensorType option', $sRow).removeAttr("selected");
			$('select.var-sensorType option[value="'+obj.sensorType+'"]', $sRow).attr("selected", "selected").closest("select").removeClass("empty");
			$('input.var-dimension', $sRow).val(obj.dimension);
		}
        $('input.var-cardinality', $sRow).val(obj.cardinality);

		if (typeof obj.attributes !== "undefined") {
			$sRow.data("attributes", obj.attributes);
		} else {
			$sRow.find("button[name='more']").remove();
		}
		if ($tbl.find("tbody:not(.tpl-sample-body)").length > 0) {
			$("tbody:not(.tpl-sample-body)", $tbl).append($sRow);
		} else {
			$tbl.append($el);
		}
		
    }
	
	function helper_addParameterDescriptorsRow($tbl, payload) {
		var obj = {
			"dataType": "string",
			"defaultValue": "",
			"description": "",
			"format": null,
			"id": "",
			"label": "",
			"notNull": false,
			"type": "REGULAR",
			"unit": null,
			"validator": null,
			"valueSet": [],
			"parameters": []
		};
		$.extend(obj, payload);

		var $el = $tbl.find(".tpl-sample-body").clone().removeClass("tpl-sample-body");
		$el.find(".tpl-sample-row").addClass("val-row").removeClass("tpl-sample-row");
		$('input.var-id', $el).val(obj.id);
		$('input.var-name', $el).val(obj.name);
		$('textarea.var-description', $el).val(obj.description);
		$('input.var-label', $el).val(obj.label);

		var td = $('.var-default', $el).parent();
		$('.var-default', $el).remove();

		if (obj.valueSet !== null && obj.valueSet.filter(function (item) { return item != 'null' && item != '' }).length > 0) {
			td.append('<select class=\'var-default col-md-10\' style=\'width:auto\'></select>');
			//$('<select class=\'var-default\' style=\'max-width:88%;\'></select>').insertBefore($(".array-btn", td));

			if (obj.defaultValue == "" || obj.defaultValue == null) {
				$(".var-default", $el).append('<option value=\'\' selected>Select</option>');
			}

			$("input.var-valueset", $el).val(obj.valueSet);
			$.each(obj.valueSet, function (index, value) {
				if (value == "null") { return true; }
				if (value == obj.defaultValue) {
					$(".var-default", $el).append('<option value=\'' + value + '\' selected>' + value + '</option>');
				} else {
					$(".var-default", $el).append('<option value=\'' + value + '\'>' + value + '</option>');
				}
			});

		} else {
			//td.append('<input type=\'text\' class=\'var-default \' style=\'width:auto; max-width:88%;\' value=\''+obj.defaultValue+'\'>');
			var inputHtml = $('<input type=\'text\' class=\'var-default \' style=\'width:auto; max-width:88%;\' value=\'' + obj.defaultValue + '\'>');
			if (obj.dataType.indexOf("[]") > -1) {
				inputHtml.addClass("tag-format");
			}
			if (obj.dataType === "date" || obj.dataType === "date[]") {
				inputHtml.addClass("datepicker");
			} else {
				inputHtml.removeClass("datepicker");
			}
			td.append(inputHtml);
		}

		$('select.var-type option', $el).removeAttr("selected");
		$('select.var-type option[value="' + obj.type + '"]', $el).attr("selected", "selected");

		$('select.var-datatype option', $el).removeAttr("selected");
		$('select.var-datatype option[value="' + obj.dataType + '"]', $el).attr("selected", "selected");

		$('input.var-unit', $el).val(obj.unit);
		if (obj.format) $('input.var-format', $el).val(obj.format);
		if (obj.validator) $('input.var-validator', $el).val(obj.validator);

		if (obj.dataType.indexOf("[]") > -1) {
			if (typeof obj.expansionRule != 'undefined') {
				$('input.var-er-id', $el).val(obj.expansionRule.id);
				$('input.var-er-separator', $el).val(obj.expansionRule.separator);
				if (obj.expansionRule.joinValues) {
					$('input.var-er-joinvalues', $el).prop({ "checked": true });
					$('.col-er-separator', $el).removeClass('collapse');
					$('input.var-er-separator', $el).val(obj.expansionRule.separator);
				}
			}
			else {
				$('input.var-er-id', $el).val(obj.id);
				$('input.var-er-separator', $el).val("");
			}
		}
		else {
			$('.col-er-joinvalues', $el).addClass('collapse');
		}
		if(obj.type === "TEMPLATE"){
			$('select.var-datatype', $el).attr('disabled', true)
		}

		if(obj.type === "TEMPLATE" && obj.parameters[0] !== undefined){
			//var $elTemp = $tbl.find(".tpl-sample-body-temp").clone().removeClass("tpl-sample-body-temp");
			$el.find(".var-unit").parents(".col-md-12").remove();
			$el.find(".var-notnull").parents(".col-md-12").remove();
			$el.find(".var-format").parents(".col-md-12").remove();
			$el.find(".var-valueset").parents(".col-md-12").remove();
			$el.find(".var-validator").parents(".col-md-12").remove();

			$el.find(".col-el-separator").remove();
			$el.find(".col-el-joinvalues").remove();

			$table = $el.find(".tbl-edt-template-params");
			$.each(obj.parameters, function(i, param){
				helper_addParameterDescriptorsRowTemplate($table,param);
			});
			
		} else if(obj.type !== "TEMPLATE"){
			$el.find(".temp-table").remove();
		}

		$tbl.append($el);
	}

	function helper_addParameterDescriptorsRowTemplate($tbl, param) {
		var objTemp = {
			"dataType": "string",
			"defaultValue": "",
			"description": "",
			"format": null,
			"id": "",
			"label": "",
			"notNull": false,
			"type": "REGULAR",
			"unit": null,
			"validator": null,
			"valueSet": [],
			"parameters": []
		};
		$.extend(objTemp, param);

		var $elTemp = $tbl.find(".tpl-sample-body-temp").clone().removeClass("tpl-sample-body-temp").addClass("temp");
		$elTemp.find(".tpl-sample-row-temp").addClass("val-row").removeClass("tpl-sample-row-temp").addClass("temp");;
				
		$('input.var-id-temp', $elTemp).val(objTemp.id);
		$('input.var-name-temp', $elTemp).val(objTemp.name);
		$('textarea.var-description-temp', $elTemp).val(objTemp.description);
		$('input.var-label-temp', $elTemp).val(objTemp.label);

		//////////
		var tdTemp = $('.var-default', $elTemp).parent();
		$('.var-default', $elTemp).remove();

		if (objTemp.valueSet !== null && objTemp.valueSet.filter(function (item) { return item != 'null' && item != '' }).length > 0) {
			tdTemp.append('<select class=\'var-default col-md-10\' style=\'width:auto\'></select>');

			if (objTemp.defaultValue == "" || objTemp.defaultValue == null) {
				$(".var-default-temp", $elTemp).append('<option value=\'\' selected>Select</option>');
			}

			$.each(objTemp.valueSet, function (index, value) {
				if (value == "null") { return true; }
				if (value == objTemp.defaultValue) {
					$(".var-default-temp", $elTemp).append('<option value=\'' + value + '\' selected>' + value + '</option>');
				} else {
					$(".var-default-temp", $elTemp).append('<option value=\'' + value + '\'>' + value + '</option>');
				}
			});

		} else {
			var inputHtml = $('<input type=\'text\' class=\'var-default \' style=\'width:auto; max-width:88%;\' value=\'' + objTemp.defaultValue + '\'>');
			if (objTemp.dataType.indexOf("[]") > -1) {
				inputHtml.addClass("tag-format");
			}
			if (objTemp.dataType === "date" || objTemp.dataType === "date[]") {
				inputHtml.addClass("datepicker");
			} else {
				inputHtml.removeClass("datepicker");
			}
			tdTemp.append(inputHtml);
		}

		//////////
		$('select.var-type-temp option', $elTemp).removeAttr("selected");
		$('select.var-type-temp option[value="' + objTemp.type + '"]', $elTemp).attr("selected", "selected");

		$('select.var-datatype-temp option', $elTemp).removeAttr("selected");
		$('select.var-datatype-temp option[value="' + objTemp.dataType + '"]', $elTemp).attr("selected", "selected");

		$('input.var-unit-temp', $elTemp).val(objTemp.unit);
		if (objTemp.format) $('input.var-format-temp', $elTemp).val(objTemp.format);
		if (objTemp.validator) $('input.var-validator-temp', $elTemp).val(objTemp.validator);

		if (objTemp.dataType.indexOf("[]") > -1) {
			if (typeof objTemp.expansionRule != 'undefined') {
				$('input.var-er-id-temp', $elTemp).val(objTemp.expansionRule.id);
				$('input.var-er-separator-temp', $elTemp).val(objTemp.expansionRule.separator);
				if (objTemp.expansionRule.joinValues) {
					$('input.var-er-joinvalues-temp', $elTemp).prop({ "checked": true });
					$('.col-er-separator-temp', $elTemp).removeClass('collapse');
					$('input.var-er-separator-temp', $elTemp).val(objTemp.expansionRule.separator);
				}
			}
			else {
				$('input.var-er-id-temp', $elTemp).val(objTemp.id);
				$('input.var-er-separator-temp', $elTemp).val("");
			}
		}
		else {
			$('.col-er-joinvalues-temp', $elTemp).addClass('collapse');
		}

		$table.append($elTemp);
			
	}

    function helper_addSysVarRow($tbl, payload){
        var obj = {"key":"","value":""};
        $.extend( obj, payload );
        var $el = $tbl.find(".tpl-sample-row").clone().addClass("val-row").removeClass("tpl-sample-row");
        $('input.var-key', $el).val(obj.key);
        $('input.var-value', $el).val(obj.value);
        $tbl.append($el);
    }
	
	function helper_addConstraintRows($tbl, payload) {
		var obj = {"" : ""};
		if (typeof payload !== "undefined" && payload !== null) {
			obj = payload;
		}
		$.each(obj, function(key, value) {
			if ($.isArray(value)) {
				$.each(value, function(idx, val) {
					addConstraintRow($tbl, key, val);
				});
			} else {
				addConstraintRow($tbl, key, value);
			}
		});
    }
	
	function addConstraintRow($tbl, key, value) {
		var $el = $tbl.find(".tpl-sample-row").clone().addClass("val-row").removeClass("tpl-sample-row");
		$('input.var-key', $el).val(key);
		$('input.var-value', $el).val(value);
		$tbl.append($el);
    }

	function helper_getFormPorts(contextTable) {
		var isTarget = contextTable.attr("id") == "tbl-edt-targets";
		var newPorts = [];
		var parentId = $('#frmExecNodeEdit input[name=inputCompID]').val();
		$(".val-row", contextTable).each(function () {
			var port_id          = $(this).find(".var-id").val();
			var port_name        = $(this).find(".var-name").val();
			var port_formatType  = $(this).find(".var-formatType").val();
			var port_formatName  = $(this).find(".var-formatName").val();
			var port_geometry	 = !isTarget ? $(this).find(".var-geometry").val() : "";
			var port_crs         = !isTarget ? $(this).find(".var-crs").val() : "";
			var port_location    = isTarget ? $(this).find(".var-location").val() : "";
			var port_sensorType  = $(this).find(".var-sensorType").val();
			var port_dimension   = $(this).find(".var-dimension").val();
			var port_cardinality = $(this).find(".var-cardinality").val();
			if( ((typeof port_name !== "undefined") && (typeof port_name.valueOf() === "string") && (port_name.length > 0)) ) {
				var newPortDesc = {
					"formatType" : port_formatType === "" ? null : port_formatType,
					"formatName" : port_formatName === "" ? null : port_formatName,
					"location"   : port_location   === "" ? null : port_location
				};
				var newPort = {
					"parentId"       : parentId,
					"name"           : port_name,
					"cardinality"    : port_cardinality,
					"id"             : port_id        === "" ? null : port_id,
				};
				
				if (isOldVersion) {
					var oldPortDesc = {
						"geometry"   : port_geometry === "" ? null : port_geometry,
						"crs"		 : port_crs === "" ? null : port_crs,
						"sensorType" : port_sensorType === "" ? null : port_sensorType,
						"dimension"  : port_dimension === "" ? null : port_dimension
					}
					$.extend(newPortDesc, oldPortDesc);
					newPort["dataDescriptor"] = newPortDesc;
				} else {
					$.extend(newPort, newPortDesc);
					var attributes = {};
					$.each($(this).data("attributes"), function(key, value) {
						if(((typeof key !== "undefined") && (typeof key.valueOf() === "string") && (key.length > 0)) &&
								((typeof value !== "undefined") && (typeof value.valueOf() === "string" || typeof value.valueOf() === "object"))) {
							if (typeof value.valueOf() === "object") {
								$.each(value, function(idx, val) {
									if (typeof val !== "undefined" && typeof val.valueOf() === "string" && val != "") {
										attributes[key] = attributes.hasOwnProperty(key) ? [...attributes[key], val] : [val];
									}
								});
							} else {
								attributes[key] = value;
							}
						}
					});
					attributes = $.isEmptyObject(attributes) ? null : attributes;
					newPort["attributes"] = $(this).data("attributes");
				}
				newPorts.push(newPort);
			}
		});
		return newPorts;
	}
	
	function keepContraints() {
		var constraintMap = {};
		$.each($(".val-row", "#tbl-edt-ports-contraints"), function(idx, val) {
			var key = $(".var-key",val).val();
			var value = $(".var-value",val).val();
			constraintMap[key] = constraintMap.hasOwnProperty(key) ? [...constraintMap[key], value] : value;
		});
		$(".val-row.edit-contraints", "#frmExecNodeEdit").data("attributes", constraintMap);
	}
	
    $(document).ready( function(){

		$("#" + $.datepicker.dpDiv.attr("id")).remove();
		//getJavaTypesOptions();
		populateDataTypeSelect($("select.var-datatype", ".tpl-sample-body"));
		populateDataTypeSelect($("select.var-datatype-temp"));
		populateSelectElem($("#inputComponentCategory", "#comp-tab-gd"), "ComponentCategory");
        
        initializeTagsInputAutocomplete("#formTags", "component"); 
        //no edit in shared workspace
        //$("#frmExecNodeEdit").on("keypress change","*", function(e){
            if((routeTags[0] === "shared") && (taoUserProfile.userRole !== "ADMIN")){
                $("#frmExecNodeEdit :input").prop("disabled", true);
                $("#frmExecNodeEdit input#formTags").css('display','');
                $("#frmExecNodeEdit div#formTags_tagsinput").hide();              
                $("#frmExecNodeEdit button[type=\"submit\"]").hide();
                $("#myModalNodes .modal-note h4").html("Warrning");
                $("#myModalNodes .modal-note p").html(SHARED_EDIT_RESTRICTED);
            }
        //});


        //get all availlable dockers
        var getAllDocker = $.ajax({
            cache: false,
            url: baseRestApiURL + "docker/",
            dataType : 'json',
            type: 'GET',
            headers: {
                "Accept": "application/json",
                "Content-Type": "application/json",
                "X-Auth-Token": window.tokenKey
            }
        });
        $.when(getAllDocker)
            .done(function (getAllDockerResponse) {
                var r = chkTSRF(getAllDockerResponse);
                //$('#inputContainerId').empty();
				//$('#inputContainerId').append('<option class="default-container" disabled selected>Choose container...</option>');
                $.each(r, function(i, value) {
                    $('#inputContainerId').append($('<option>').text(value.name).attr('value', value.id).data("applications", value.applications));
                });

                if(userOpStack[0] && userOpStack[0].action ==="comp_edit" && userOpStack[0] && userOpStack[0].dna.id){
                    $(".modal-title").html("Edit processing module: <span>" + userOpStack[0].dna.label.toUpperCase() + "</span>");
					$("#helpId").prop("hidden", true);
                    $("#saveExecNode").html("Save processing module");
                    $("#inputCompID").attr('disabled','disabled');
                    $("#inputComponentType").attr('disabled','disabled');
					$("#inputTemplateType").attr('disabled','disabled');
                    getComponentDataById(userOpStack[0].dna.id);
                }
            })
            .fail(function () {
                showMsg("Could not retrive dockers list.", "ERROR");
            });

		

		$("#inputContainerId").on("change", function(){

			$('#inputFileLocation').empty();
			$("#inputFileLocation").append('<option class="default-file" disabled selected>Select file location...</option>')
			var applications = $(this).find("option:selected:not(.default-container)").data("applications");
			$.each(applications, function(idx, app){
				$("#inputFileLocation").append($('<option>').text(app.name).attr('value',app.path).data({"path": app.path, "name": app.name}));
			})

			if( $("#inputComponentType").find("option:selected").val() === "SCRIPT" && ($("#inputContainerId").find("option:selected").text()).startsWith("python") ){
				// if container is python add syntax highlight
				editor.getSession().setMode("ace/mode/python");
				$("#openJupyterLab").removeClass("hidden");
			}else{
				$("#openJupyterLab").addClass("hidden");
			}
		});

		$("#inputComponentType").on("change", function(){
			if( $("#inputComponentType").find("option:selected").val() === "SCRIPT" && ($("#inputContainerId").find("option:selected").text()).startsWith("python") ){
				$("#openJupyterLab").removeClass("hidden");
			}else{
				$("#openJupyterLab").addClass("hidden");
			}
		});

        $("#inputTemplateType").on("change", function(){
			var lclVal = $(this).val();
			if(lclVal === "XSLT"){
				editor.getSession().setMode("ace/mode/xml");
			}else{
				editor.getSession().setMode("ace/mode/"+ lclVal.toLowerCase());
			}
		})
		.trigger("change");

        $(".btn-comp-addnewvar").on("click", function(){
            var $tbl = $(this).closest(".tbl-edt");
            helper_addSysVarRow($tbl);
        });
		$(".btn-ports-addnewconstraint").on("click", function(){
            var $tbl = $(this).closest(".tbl-edt");
            helper_addConstraintRows($tbl);
        });
        $(".btn-comp-addnewparam").on("click", function(){
            var $tbl = $(this).closest(".tbl-edt");
            helper_addParameterDescriptorsRow($tbl);
        });
        $(".btn-comp-addnewsrc, .btn-comp-addnewtrgt").on("click", function () {
            helper_addSourceTargetDescriptorsRow($(this).closest("table"), void 0, sourceTargetSpecificFormats)
        });
		$(".tbl-edt")
			.on('focusin', 'select', function () {
				$(this).data('val', $(this).val());
			})
			.on("change", ".select-datatypes", function () {
				var previousVal = $(this).data('val');
				var selVal = $(this).val();

				if ($('.var-default', $(this).closest("tr")).is("input")) {
					if (previousVal.indexOf(selVal) < 0 && selVal.indexOf(previousVal) < 0) {
						$('.var-default', $(this).closest("tr")).val('');
					}
					if (selVal.indexOf('[]') > -1) {
						$('.var-default', $(this).closest("tr")).addClass("tag-format");
					} else {
						$('.var-default', $(this).closest("tr")).removeClass("tag-format");
						$('.var-default', $(this).closest("tr")).destroyTagsInput();
					}
					if (selVal === "date" || selVal === "date[]") {
						$('.var-default', $(this).closest("tr")).addClass("datepicker");
					} else {
						$('.var-default', $(this).closest("tr")).removeClass("datepicker");
					}

				}
				var $elPlus = $(this).closest("tr").next(".val-row-plus");
				if (selVal.indexOf("[]") > -1) {
					$('.col-er-joinvalues', $elPlus).removeClass('collapse');
				}
				else {
					$('.col-er-joinvalues', $elPlus).addClass('collapse');
					$('input.var-er-joinvalues', $elPlus).prop({ "checked": false });
					$('.col-er-separator', $elPlus).addClass('collapse');
					$('input.var-er-separator', $elPlus).val("");
				}
				fieldFormat();
			}).trigger("change")
			.on("click", ".tbl-sysvar-delete-action", function (e) {
				e.preventDefault();
				$(this).closest(".val-row").remove();
			})
			.on("click", ".tbl-prop-expand-action", function (e) {
				e.preventDefault();
				if ($(this).hasClass("active")) {
					$(".val-row-plus").css({ "display": "none" });
					$(this).removeClass("active");
					return;
				}
				$(".val-row-plus").css({ "display": "none" });
				$(".tbl-prop-expand-action").removeClass("active");
				$(this).addClass("active");
				$(this).closest("tr").next().css({ "display": "table-row" });
			})
			.on("click", ".tbl-prop-expand-action-temp", function (e) {
				e.preventDefault();
				if ($(this).hasClass("active")) {
					$(".val-row-plus-temp").css({ "display": "none" });
					$(this).removeClass("active");
					return;
				}
				$(".val-row-plus-temp").css({ "display": "none" });
				$(".tbl-prop-expand-action-temp").removeClass("active");
				$(this).addClass("active");
				$(this).closest("tr").next().css({ "display": "table-row" });
			})
			.on("click",".btn-comp-addnewparam-temp", function(){
            	var $tbl = $(this).closest(".tbl-edt-template-params");
            	helper_addParameterDescriptorsRowTemplate($tbl);
        	})
			.on("click", ".tbl-prop-delete-action", function (e) {
				e.preventDefault();
				$(this).closest("tbody").remove();
			})
			.on("click", ".tbl-prop-delete-action-temp", function (e) {
				e.preventDefault();
				$(this).closest("tbody").remove();
			})
			.on("click", ".tbl-port-delete-action", function (e) {
				e.preventDefault();
				$(this).closest(".val-row").remove();
			})
			.on("change", ".var-er-joinvalues", function (e) {
				if ($(this).is(":checked")) {
					$(".col-er-separator", $(this).closest("tr")).removeClass('collapse');
				}
				else {
					$(".var-er-separator", $(this).closest("tr")).val('');
					$(".col-er-separator", $(this).closest("tr")).addClass('collapse');
				}
			})
			.on("click", "button[name='more']", function () {
				var rowData = $(this).closest(".val-row").data("attributes");
				$(".val-row.edit-contraints", "#frmExecNodeEdit").removeClass("edit-contraints");
				$(this).closest(".val-row").addClass("edit-contraints");
				$(".val-row", "#tbl-edt-ports-contraints").remove();
				if (typeof rowData !== "undefined" && rowData !== null && !$.isEmptyObject(rowData)) {
					helper_addConstraintRows($("#tbl-edt-ports-contraints"), rowData);
				}
				var rowName = $(this).closest(".val-row").find(".var-name").val();
				$("#moreDialogModalLabel", "#moreDialog").html("More attributes" + (rowName !== "" ? (": " + rowName) : ""));
				$("#moreDialog").modal('show');
			});

		$("#" + $.datepicker.dpDiv.attr("id")).remove();
		$(".datepicker").datepicker({
			dateFormat: "yy-mm-dd"
		});

        //remove error for some input elements
        $("input, textarea","form#frmExecNodeEdit")
            .on("keypress change", function(){
                if($(this).data("errorspan")) {
                    $(".error-" + $(this).data("errorspan"), ".modal-error").css('display', 'none');
                    if($(".modal-error").find("span:visible").length == 0) {
                        $(".modal-error").hide();
                        $("#saveExecNode").removeAttr('disabled');
                    }
                }
            });
            /*.on("focusout", function(){
                if($(this).data("errorspan")){
                    if (($(this).val() === "")||($(this).val() === 0)||($(this).val() === "0")){
                        $(".error-"+$(this).data("errorspan"),".modal-error").css('display', 'inline-block');
                        $(".modal-error").fadeIn("slow");
                        $("#saveExecNode").attr('disabled','disabled');
                    }
                }
            });*/
		
		$("table").on("change", "select[class^='var-']", function () {
			if (this.value == "") {
				$(this).addClass("empty");
			} else {
				$(this).removeClass("empty");
			}
		});
		
		function guid() {
		  return s4() + s4() + '-' + s4() + '-' + s4() + '-' + s4() + '-' + s4() + s4() + s4();
		}
		function s4() {
		  return Math.floor((1 + Math.random()) * 0x10000)
			.toString(16)
			.substring(1);
		}
		
		$("#openJupyterLab").on("click", function (e) {
            var $jupyter = $("#jupyterLab");
            if ($jupyter.length == 0) {
                $jupyter = $('<div id="jupyterLab" class="modal fade in" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="false"><div class="modal-dialog modal-lg"></div></div>');
            }
            $jupyter.off('hidden.bs.modal');
            $jupyter.on('hidden.bs.modal', function (e) {
                $jupyter.remove();
            });            

            $("#myModalNodes").after($jupyter);
            $(".modal-dialog",$jupyter).addClass("modal-lg");
            rm_contentUrl="./fragments/component-jupyterlab.fragment.html?" + Math.random();
            $.ajax({
                url: rm_contentUrl,
                success: function(result) {
                    rmContent = result;
                    if(rmContent !== ''){
                        $jupyter.find('.modal-dialog').html(rmContent);
						// start jupyter docker
						$.ajax({
							"async": false,
							"crossDomain": true,
							"url": baseRestApiURL + "docker/start?id=jupyterlite",
							"method": "POST",
							headers: {
								"X-Auth-Token": window.tokenKey
							},
							"success": function(result) {
								// update iframe and recover ui parameters
								var idx = result.data.indexOf(":");
								var port = idx > 0 ? result.data.substring(idx + 1) : "";
								jupyterContainerId = result.data.substring(0, idx);
								var paramData = {
									"parameterDescriptors": [
											{
											"name": "",
											"dataType": "bool",
											"defaultValue": "true"}
										]}
								paramData.parameterDescriptors = [];
								var $tblParameterDescriptors = $("#comp-tab-param table");
								$("tbody:not(.tpl-sample-body)", $tblParameterDescriptors).each(function(){
									var name = $(this).find(".val-row input.var-name").val();
									var datatype = $(this).find(".val-row .var-datatype").val();
									var defaultval = $(this).find(".val-row .var-default").val();
									var newParameterDescriptor = {
										"name": name,
										"dataType": datatype,
										"defaultValue": defaultval
									};
									paramData.parameterDescriptors.push(newParameterDescriptor);
								});
								$("#jupyterFrame").prop('src', window.baseRestApiURL.substring(0, window.baseRestApiURL.length - 1) + ':' + port + '/lab?token=' + taoUserProfile.id);
								// <!-- Generate template / notebook -->
								$.ajax({
									"async": true,
									"crossDomain": true,
									"contentType": "application/json",
									"url": baseRestApiURL + "jupyter",
									"method": "POST",
									"data" : JSON.stringify(paramData.parameterDescriptors)
								});
							}
						});
                    }
                    $jupyter.modal('show');
                }
            });
        });


		$("form#frmExecNodeEdit").validate({
			rules: {
				inputCompID: {
					required: true,
				},
				inputCompLabel: {
					required: true
				},
				inputCompVersion: {
					required: true
				}
			},
			highlight: function(element, errorClass) {
				$(element).parent().addClass("has-error");
			},
			unhighlight: function(element, errorClass) {
				$(element).parent().removeClass("has-error");
			},
			messages: {
			},
			errorPlacement: function(error, element) {
				error.appendTo(element.parent());
			},
			success: function(label) {
				label.remove();
			}
		});

        $("form#frmExecNodeEdit").submit(function (e) {
            e.preventDefault();

			if((routeTags[0] === "shared") && (taoUserProfile.userRole !== "ADMIN")){
				showMsg(SHARED_EDIT_RESTRICTED, "ERROR");
				return -1;
			}
			var tags = [];
            if( $(".tagsinput .tag .tag-text").length >=1){
		        $(".tagsinput .tag .tag-text").each(function(i){tags.push($(this).text())});
            }else{
                tags = null;
            }

            var formData = {
                    "id": $('input[name=inputCompID]', this).val(),
                    "label" : $('input[name=inputCompLabel]', this).val(),
                    "version" : $('input[name=inputCompVersion]', this).val(),
                    "description" : $('textarea[name=inputCompDescription]', this).val(),
                    "authors" : $('input[name=inputCompAuthors]', this).val(),
                    "copyright" : $('input[name=inputCompCopyright]', this).val(),
                    "category" : $('select[name=inputComponentCategory]', this).val(),
                    "nodeAffinity": "Any",
					"componentType": $('select[name=inputComponentType]', this).val(),
                    "parallelism" : parseInt($('input[name=inputCompParallelism]', this).val()),
					"sources": [],
                    "targets": [],
					"tags": tags,
                    "containerId": $('select[name=inputContainerId]', this).val(),
                    "fileLocation" : $('select[name=inputFileLocation]', this).find("option:selected:not(.default-file)").data("path"),
                    "workingDirectory" : $('input[name=inputWorkingDirectory]', this).val(),
                    "templateType" : $('select[name=inputTemplateType]', this).val(),
					"outputManaged": $("#managedOutput", this).is(":checked"),
                    "templateEngine": {
                        "type": "ro.cs.tao.component.template.engine.VelocityTemplateEngine",
                        "templateType": "VELOCITY"
                    },
                    "template": {
//                        "type": "ro.cs.tao.component.template.BasicTemplate",
//                        "name": "segmentation-cc-template.vm",
//                        "templateType": "VELOCITY",
//                        "contents": "-in $sourceProductFile -filter.cc.expr $expr_string -mode.vector.out $out_str -mode.vector.outmode $outmode_string -mode.vector.neighbor $neighbor_bool -mode.vector.stitch $stitch_bool -mode.vector.minsize $minsize_int -mode.vector.simplify $simplify_float -mode.vector.layername $layername_string -mode.vector.fieldname $fieldname_string -mode.vector.tilesize $tilesize_int -mode.vector.startlabel $startlabel_int"
                    },
                    "variables": [{
                        "key": "ITK_AUTOLOAD_PATH",
                        "value": "E:\\OTB\bin"
                    }],
                    "visibility": $('select[name=inputVisibility]', this).val(),
                    "active": $('select[name=inputActive]', this).val(),
                    "parameterDescriptors": [
                        {
                        "id": "outmode_string",
						"name": "",
                        "type": 1,
                        "dataType": "string",
                        "defaultValue": "ulco",
                        "description": "This allows setting the writing behaviour for the output vector file. Please note that the actual behaviour depends on the file format.",
                        "label": "outmode_string",
                        "unit": null,
                        "valueSet": null,
                        "format": null,
                        "notNull": false,
                        "validator": null,
						"parameters": null
                         }, {
                        "id": "neighbor_bool",
                        "type": 1,
                        "dataType": "bool",
                        "defaultValue": "true",
                        "description": "Activate 8-Neighborhood connectivity (default is 4).",
                        "label": "neighbor_bool",
                        "unit": null,
                        "valueSet": null,
                        "format": null,
                        "notNull": false,
                        "validator": null,
						"parameters": null
                        }
                    ]
            };
            formData.templatecontents = editor.getValue();
            //add template to payload for template type VELOCITY
//            if(formData.templateType === "VELOCITY"){
//                formData.template={
//                    "type": "ro.cs.tao.component.template.BasicTemplate",
//                    "name" : $('input[name=inputTemplateName]', this).val(),
//                    "templateType": "VELOCITY",
//                    "contents" : $('textarea[name=inputTemplateContents]', this).val()
//                };
//            }

            // add system variable to payload parsing user defined system vars table
            formData.variables = [];
            var $tblCompSysVar = $("#comp-tab-sys table");
            $(".val-row", $tblCompSysVar).each(function() {
                var k = $(this).find("input.var-key").val();
                var v = $(this).find("input.var-value").val();
                var newSysVar = {};
                if( ((typeof k !== "undefined") && (typeof k.valueOf() === "string") && (k.length > 0)) && ((typeof v !== "undefined") && (typeof v.valueOf() === "string"))) {
                    newSysVar.key = k;
                    newSysVar.value = v;
                    formData.variables.push(newSysVar);
                }else{
                    showMsg("Invalid system variables. Please choose valid names or values to continue.", "ERROR");
                    return false;
                }
            });
            //add parameterDescriptors to payload parsing user defined parameterDescriptors table
            formData.parameterDescriptors = [];
            var $tblParameterDescriptors = $("#comp-tab-param table");
            var templateDescriptors = [];
            $("tbody:not(.tpl-sample-body):not(.tpl-sample-body-temp):not(.temp)", $tblParameterDescriptors).each(function(){
                var id = $(this).find(".val-row input.var-id").val();
                var name = $(this).find(".val-row input.var-name").val();
                var label = $(this).find(".val-row input.var-label").val();
                var description = $(this).find(".val-row .var-description").val();
                var type = $(this).find(".val-row .var-type").val();
                var datatype = $(this).find(".val-row .var-datatype").val();
                var defaultval = $(this).find(".val-row .var-default").val();

				if (type !== "TEMPLATE") {
					var format = $(this).find(".val-row-plus input.var-format").val();
					var unit = $(this).find(".val-row-plus input.var-unit").val();
					var validator = $(this).find(".val-row-plus input.var-validator").val();
					var notnull = $(this).find(".val-row-plus .var-notnull").is(":checked");
					var valueSet = $(this).find(".val-row-plus input.var-valueset").val();
					var templateParameters = [];
				} else {
					var templateParameters = [];
					var $tblParameterDescriptorsTemplateParameters = $(this).find(".tbl-edt-template-params");
					//$.each($("tbody.temp"),$tblParameterDescriptorsTemplateParameters, function(i, param){
					$("tbody.temp", $tblParameterDescriptorsTemplateParameters).each(function(){
						var idTemp = $(this).find(".val-row input.var-id-temp").val();
                		var nameTemp = $(this).find(".val-row input.var-name-temp").val();
                		var labelTemp = $(this).find(".val-row input.var-label-temp").val();
                		var descriptionTemp = $(this).find(".val-row .var-description-temp").val();
            			var typeTemp = $(this).find(".val-row .var-type-temp").val();
            	    	var datatypeTemp = $(this).find(".val-row .var-datatype-temp").val();
                		var defaultvalTemp = $(this).find(".val-row .var-default-temp").val();

						var formatTemp = $(this).find(".val-row-plus input.var-format-temp").val();
						var unitTemp = $(this).find(".val-row-plus input.var-unit-temp").val();
						var validatorTemp = $(this).find(".val-row-plus input.var-validator-temp").val();
						var valueSetTemp = $(this).find(".val-row-plus input.var-valueset-temp").val();
						var notnullTemp = $(this).find(".val-row-plus .var-notnull-temp").is(":checked");

						var newTemplateParameter = {
							"id": idTemp,
							"name": nameTemp,
							"type": typeTemp,
							"dataType": datatypeTemp,
							"defaultValue": defaultvalTemp,
							"description": descriptionTemp,
							"label": labelTemp,
							"unit": unitTemp,
							"valueSet": valueSetTemp,
							"format": formatTemp,
							"notNull": notnullTemp,
							"validator": validatorTemp
						}

						templateParameters.push(newTemplateParameter);
					});

				}

                if (!((typeof id !== "undefined") && (typeof id.valueOf() === "string") && (id.length > 0))) {
					id = guid();
				}

				if (format !== undefined){
					if (format.trim()=== ''){format = null;}
				}
				if (unit !== undefined){
					if (unit.trim()=== ''){unit = null;}
				}
				if (validator !== undefined){
					if (validator.trim()=== ''){validator = null;}
				}
				if (valueSet !== undefined){
					if (valueSet.trim()=== ''){valueSet = null;}
				}
				var newParameterDescriptor;
				if (templateParameters.length == 0) {
					newParameterDescriptor = {
						"id": id,
						"name": name,
						"type": type,
						"dataType": datatype,
						"defaultValue": defaultval,
						"description": description,
						"label": label,
						"unit": unit,
						"valueSet": valueSet != null ? valueSet.split(",") : [],
						"format": format,
						"notNull": notnull,
						"validator": validator
					};
				} else {
					newParameterDescriptor = {
						"id": id,
						"name": name,
						"type": type,
						"dataType": datatype,
						"defaultValue": defaultval,
						"description": description,
						"label": label,
						"unit": unit,
						"valueSet": null,
						"format": format,
						"notNull": notnull,
						"validator": validator,
						"parameters": templateParameters
					};
				}

				if (datatype.indexOf("[]") > -1) {
					var erId = $(this).find(".val-row-plus .var-er-id").val();
					var erJoinValues = $(this).find(".val-row-plus .var-er-joinvalues").is(":checked");
					var erSeparator = $(this).find(".val-row-plus .var-er-separator").val();

					newParameterDescriptor["expansionRule"] = {
						"id": erId,
						"joinValues": erJoinValues,
						"separator": erSeparator
					}
				}

				if (type !== "TEMPLATE") {
					// only add non-template parameters, the template ones will be handled separately
					formData.parameterDescriptors.push(newParameterDescriptor);
				} else {
					templateDescriptors.push(newParameterDescriptor);
				}
            });
			
            //add sources and targets to payload parsing user defined port tables
            formData.sources = helper_getFormPorts($("#tbl-edt-sources"));
            formData.targets = helper_getFormPorts($("#tbl-edt-targets"));
            if(1){
				var isValid = true;
				if (formData.id === '') {
					showMsg("Component ID can not be empty. Please choose valid values to continue.", "ERROR");
					isValid =  false;
            	}
				if (formData.label === '') {
					showMsg("Label can not be empty. Please choose valid values to continue.", "ERROR");
					isValid =  false;
				}
				if (formData.version === '') {
					showMsg("Version can not be empty. Please choose valid values to continue.", "ERROR");
					isValid =  false;
				}
				if (!$(this).valid()) {
					isValid = false;
				}
				if(typeof ($('select[name=inputFileLocation]', this).find("option:selected:not(.default-file)").data("path")) === 'undefined'){
					showMsg("File location is not set.", "ERROR");
					isValid = false;
				}
				if(editor.getValue() === ''){
                	showMsg("Template contents can not be empty.", "ERROR");
					isValid = false;
				}
				if($("#tbl-edt-sources tr.val-row").length <=0 || $("#tbl-edt-targets tr.val-row").length <= 0){
					showMsg("At least one source and target must be defined.", "ERROR");
					isValid = false;
				}
				if(!isValid){
					return isValid;
				}
			}			
			
            var regexp = /^[a-zA-Z0-9-_.]+$/;
            if (formData.id.search(regexp) === -1)
            {
                showMsg("The component id contains invalid characters.", "ERROR");
                return;
            }
			
			var callType = (userOpStack[0] && userOpStack[0].action ==="comp_edit") ? "PUT" : "POST";
            $.ajax({
                cache: false,
                url: baseRestApiURL + "component/" + (callType === "PUT" ? formData.id : ""),
                dataType: 'json',
                type: callType,
                data: JSON.stringify(formData),
                headers: {
                    "Accept": "application/json",
                    "Content-Type": "application/json",
                    "X-Auth-Token": window.tokenKey
                },
                error : function (jqXHR, textStatus, errorThrown) {
                    if(jqXHR.status === 500){
                        showMsg("Error adding processing module. Please check your data and try again.", "ERROR");
                        return;
                    }
                    showMsg("Unknown error. Unable to update processing module. Please try again.", "ERROR");
                },
                success: function(response,textStatus, jqXHR) {
                    var r = chkTSRF(response);
                    if (response.status === "FAILED"){
                        if(response.message){
                            showMsg("Error adding processing module. Please check your data, one or more values for the attributes was not in the acceptable range.", "ERROR");
                            //handle error messages

                            var objResponse = JSON.parse(jqXHR.responseText);
                            objResponse = objResponse.message.split(';');
                            if (objResponse[0] !== "Entity has validation errors") {
                                return;
                            }
                            for (i = 0; i < objResponse.length; i++) {
                                var matches = objResponse[i].match(/\[(.*?)\]/);
                                if (matches) {
                                    //$(".error-"+matches[1],".modal-error").show();
                                    $(".error-"+matches[1],".modal-error").css('display', 'inline-block');
                                }
                            }
                            $(".modal-error ").fadeIn("slow");
                            $('#myModalNodes').animate({scrollTop: 0}, 250);
                            return;
                        }
                        showMsg("Error adding or updating processing module. Please check your data and try again.", "ERROR");
                    } else {
                    	if (templateDescriptors.length > 0) {
                    		for (idx = 0; idx < templateDescriptors.length; idx++) {
								$.ajax({
									cache: false,
									url: baseRestApiURL + "component/" + formData.id + "/" + templateDescriptors[idx].id,
									dataType: 'json',
									type: "PUT",
									data: JSON.stringify(templateDescriptors[idx]),
									headers: {
										"Accept": "application/json",
										"Content-Type": "application/json",
										"X-Auth-Token": window.tokenKey
									},
									error : function (jqXHR, textStatus, errorThrown) {
										if(jqXHR.status === 500){
											showMsg("Error adding or updating template parameter. Please check your data and try again.", "ERROR");
											return;
										}
										showMsg("Unknown error. Unable to update processing module. Please try again.", "ERROR");
									},
									success: function(response,textStatus, jqXHR) {
										var r = chkTSRF(response);
										if (response.status === "FAILED") {
											if (response.message) {
												showMsg("Error adding or updating template parameter. Please check your data, one or more values for the attributes was not in the acceptable range.", "ERROR");
												//handle error messages

												var objResponse = JSON.parse(jqXHR.responseText);
												objResponse = objResponse.message.split(';');
												if (objResponse[0] !== "Entity has validation errors") {
													return;
												}
												for (i = 0; i < objResponse.length; i++) {
													var matches = objResponse[i].match(/\[(.*?)\]/);
													if (matches) {
														//$(".error-"+matches[1],".modal-error").show();
														$(".error-"+matches[1],".modal-error").css('display', 'inline-block');
													}
												}
												$(".modal-error ").fadeIn("slow");
												$('#myModalNodes').animate({scrollTop: 0}, 250);
												return;
											}
											showMsg("Error adding or updating template parameter. Please check your data and try again.", "ERROR");
										}
									}
								});
							}
						}
                    }
                    showMsg("Processing module successfully saved.", "SUCCESS");
                    $("#myModalNodes").modal('hide');
                    panelComp.refreshData();
                }
            });
            return false;
        });
		
		$("#moreDialog").on("click", "button.close-modal", function(e) {
			e.preventDefault();
			$(".modal-backdrop:last").remove();
			$("#moreDialog").modal("hide");
		})
		.on('hidden.bs.modal', function (event) {
			keepContraints();
			$(".val-row.edit-contraints", "#frmExecNodeEdit").removeClass("edit-contraints");
		});
		/*.on("click", "#doneModifConstraints", function() {
			var constraintMap = {};
			$.each($(".val-row", "#tbl-edt-ports-contraints"), function(idx, val) {
				if ($(".var-key",val).val() !== "") {
					constraintMap[$(".var-key",val).val()] = $(".var-value",val).val();
				}
			});
			constraintMap = $.isEmptyObject(constraintMap) ? null : constraintMap;
			$(".val-row.edit-contraints", "#frmExecNodeEdit").data("attributes", constraintMap);
			$("#moreDialog").modal("hide");
		});*/
    });
    //# sourceURL=comp-plus.js
</script>
