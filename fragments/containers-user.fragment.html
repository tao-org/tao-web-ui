<style>
	textarea{resize: none;}
	.nodes-item-core-box .box-top .box-text{line-height:1.3em;white-space:nowrap;overflow:hidden}
	.nodes-item-core-box .box-description{background:#e3f3fc;padding:5px 15px;margin:10px -15px 10px -15px;line-height:1.2em;color:#555}
	.nodes-item-core-box .box-bottom{padding:0}
	img.base64image{position:relative;display:block;width:100px;height:100px;margin:5px 0 0 0;border-radius:15px;background-color:white;padding:5px;box-shadow:3px 3px 5px 0 rgba(51, 51, 51, 0.12);border-bottom:2px solid #3c8dbc}
	img.base64image.empty{box-shadow:none;border:0}
	img.base64image.empty::before{content:" ";position:absolute;display:block;width:100%;height:100%;background-color:white}
	img.base64image.empty::after{content:" ";position:absolute;display:block;width:94px;height:94px;border-radius:15px;background-repeat:no-repeat;background-color:white;background-image:url(../media/images/preview-not-available.png);background-position:center;box-shadow:3px 3px 5px 0 rgba(51, 51, 51, 0.12);border-bottom:2px solid #3c8dbc}
</style>

<!-- modal nodes op -->
<div id="myModalNodes" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
	</div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<!-- modal nodes op -->


<!-- modal nodes container descriptor -->
<div id="myModalNodesContDesc" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
	</div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<!-- modal nodes op -->


<!-- modal nodes component descriptor -->
<div id="myModalNodesCompDesc" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
	</div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<!-- modal nodes op -->



<!-- Content Header (Page header) -->
<section class="content-header tao-async-ph">
	<h1>Toolbox Containers <small>The available docker<strong> containers</strong> that can be used for processing.</small></h1>
	<ol class="breadcrumb">
		<li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
		<li class="active">Toolbox Containers</li>
	</ol>
</section>
<!-- /Content Header (Page header) -->
<!-- Main content -->
<section class="content tao-async-mc">
	<div id="panel-topo-wrapper" class="row collapseX">
		<div class="col-md-12">
			<!-- Custom Tabs -->
			<div class="nav-tabs-custom">
				<ul class="nav nav-tabs visible-xs-block"> <!-- visible-xs-block -->
					<li class="role-dropdown active">
						<select id="selectNodePanel" name="selectNodePanel" class="form-control form-changepane" title="Select desired node view.">
							<option class="role role-admin" value="active_nodes">Online nodes</option>
						</select>
					</li>
				</ul>
				<ul class="nav nav-tabs hidden-xs">
					<li class="role role-admin active"><a href="#panel-nodes" data-toggle="tab" data-action="active_nodes" aria-expanded="true">Toolbox container</a></li>
				</ul>
				
				<div class="tab-content">
					<div class="tab-pane active" id="panel-nodes">
						<div class="row">
							<div class="col-md-12" id="list-master-controls">
								<div class="box-tools pull-left">
									<button class="btn btn-master-tool text-black" data-action="op-plus" data-toggle="tooltip" data-original-title="Add new toolbox container"><i class="fa fa-plus"></i></button>
								</div>
								<div class="box-tools pull-left">
									<button class="btn btn-master-tool text-black" data-action="op-filter" data-toggle="tooltip" data-original-title="Filter by tags"><i class="fa fa-filter"></i><span class="label label-warning val-count-filters" style="display:none;">0</span></button>
								</div>
								<div class="box-tools pull-left">
									<form class="search-container collapse" action="">
										<input id="search-box" type="text" class="search-box" name="q" placeholder="Search by label" />
										<label for="search-box"><i class="fa fa-search search-icon" aria-hidden="true"></i></label>
										<input type="submit" id="search-submit" />
									</form>
								</div>
								<div class="box-tools pull-right">
									<button class="btn btn-master-tool text-black" data-action="refresh-list" data-toggle="tooltip" data-original-title="Refresh"><i class="fa fa-refresh fa-spin-hover"></i></button>
									<button class="btn btn-master-tool text-black" data-action="view-list" data-toggle="tooltip" data-original-title="List view"><i class="fa fa-list"></i></button>
									<button class="btn btn-master-tool text-black" data-action="view-table" data-toggle="tooltip" data-original-title="Grid view"><i class="fa fa-table"></i></button>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-md-12 like collapse">
								<span data-tag="tag">Label like: <strong class="val-q"></strong>&nbsp;<i class="fa fa-times fa-fw clear-search" aria-hidden="true"></i></span>
							</div>
							<div class="col-md-12 tags collapse">
								<span class="collapse" data-tag="tag">tag<i class="fa fa-check fa-fw" aria-hidden="true"></i></span>
							</div>
						</div>
						<div class="row" id="list-work-users">
							<div class="col-sm-12">
								<div class="box box-success">
									<div class="box-header">
										<i class="fa fa-th-large" aria-hidden="true"></i>
										<h3 class="box-title">Containers -  <span class="val-itemfrom">0</span> to <span class="val-itemto">0</span> of <span class="val-itemscount">0</span></h3>
										<div class="box-tools pull-right nppaginatedcells-order collapse" data-toggle="tooltip" title="Change order"></div>
									</div>
									<div class="nppaginatedcells-empty callout callout-empty">
										<p>List is empty. <span class="results-empty">You do not have any container.</span><span class="filter-results-empty collapse">Your current selection returned no results.</span></p>
									</div>
									<div class="box-body chat users-box">
										<div class="nppaginatedcells-panel-body"></div>
										<div class="cell-templates collapse">
											<core-cell-list>
												<div class="col-md-12 col-sm-12">
													<div class="nodes-item-core-box">
														<div class="box-top-tags">
															<span>Tag1</span><span>Tag2</span><span>Tag3</span>
														</div>
														<div class="box-top">
															<div class="box-title"><span class="val-name"> Lynx Node </span></div>
															<div class="box-subtitle"><i><span class="val-tag"> Tag </span></i></div>
															<div class="box-text">
																APPLICATIONS: <strong><span class="val-appsCount"> 0 </span></strong> | 
																FORMATS: <strong><span class="val-formatCount"> 0 </span></strong> | 
																Path: <strong><span class="val-applicationPath"> 0 </span></strong>
															</div>
															<div class="box-icon">
																<img class="base64image" src="" />
															</div>
														</div>
														<div class="box-description row"><span class="val-description"> Description </span></div>
														<div class="row">
															<div class="col-md-6 col-sm-12 col-xs-12">
																<button type="button" class="btn btn-primary btn-sm btn-flat btn-action btn-nodeop" data-action="edit"><i class="fa fa-pencil fa-fw" aria-hidden="true"></i><span class="span-muted">&nbsp;Edit</span></button>
															</div>
														</div>
													</div>
												</div>
											</core-cell-list>
											<core-cell-grid>
												<div class="col-lg-3 col-md-4 col-sm-6">
													<div class="nodes-item-core-box">
														<div class="box-top-tags">
															<span>Tag1</span><span>Tag2</span><span>Tag3</span>
														</div>
														<div class="box-top">
															<div class="box-title"><span class="val-name"> Lynx Node </span></div>
															<div class="box-subtitle"><i><span class="val-tag"> Tag </span></i></div>
															<div class="box-text">
																APPLICATIONS: <strong><span class="val-appsCount"> 0 </span></strong><br/>
																FORMATS: <strong><span class="val-formatCount"> 0 </span></strong><br/>
																Path: <strong><span class="val-applicationPath"> 0 </span></strong>
															</div>
															<div class="box-icon">
																<img class="base64image" src="" />
															</div>
														</div>
														<div class="box-description"><span class="val-description"> Description </span></div>
														<div class="box-bottom">
															<div class="text-left">
																<button type="button" class="btn btn-primary btn-sm btn-flat btn-action btn-nodeop" data-action="edit"><i class="fa fa-pencil fa-fw" aria-hidden="true"></i><span class="span-muted collapse">&nbsp;Edit</span></button>
																<button type="button" class="btn btn-primary btn-sm btn-flat btn-action btn-nodeop invisible" data-action="delete"><i class="fa fa-trash-o fa-fw" aria-hidden="true"></i><span class="span-muted collapse">&nbsp;Delete</span></button>
															</div>
														</div>
													</div>
												</div>
											</core-cell-grid>
										</div>
									</div>
									<div class="box-footer clearfix no-border">
										<div class="box-tools pull-right">
											<ul class="nppaginatedcells-panel-pagination pagination pagination-sm inline">
												<li><a href="#" data-page="prev">«</a></li>
												<li class="active"><a href="#" data-page="0">1</a></li>
												<li><a href="#" data-page="1">2</a></li>
												<li><a href="#" data-page="2">3</a></li>
												<li><a href="#" data-page="next">»</a></li>
											</ul>
										</div>
									</div>
									<div class="box-notification"><p><span>List updated</span></p></div>
								</div>
							</div>
						</div>
					</div><!-- /.tab-pane -->
					
					<div class="tab-pane" id="panel-nodesX">
					</div><!-- /.tab-pane -->
					
				</div><!-- /.tab-content -->
			</div><!-- nav-tabs-custom -->
		</div>
	</div>
</section><!-- /.content -->
<script>
	var nameListTC = [];
	myModalNodesOpShow = function (operationid, args) {
		var $modal = $("#myModalNodes");
		$(".modal-dialog", $modal).removeClass("modal-lg");
		var rm_contentUrl = '';
		var rmContent = '';
		window.userOpStack = [];
		
		if (operationid === "op-plus") {
			$(".modal-dialog", $modal).addClass("modal-lg");
			rm_contentUrl="./fragments/containers-user-plus.fragment.html?" + Math.random();
		}
		if(operationid === "edit"){
			$(".modal-dialog", $modal).addClass("modal-lg");
			window.userOpStack = { "dna": args.dna };
			rm_contentUrl="./fragments/containers-user-edit.fragment.html?" + Math.random();
		}
		if (rm_contentUrl === '') {
			alert("AVL - Operation mismatch");
			return;
		}
		$.ajax({
			url: rm_contentUrl,
			success: function(result) {
				rmContent = result;
				if (rmContent !== '') {
					$modal.find('.modal-dialog').html(rmContent);
				} else {
					alert("Could not retrive needed data from server.");
					return e.preventDefault();
				}
				$modal.modal('show');
			}
		});
	};

	deleteContainerbyId = function(id){
		var deleteContainer = $.ajax({
            cache: false,
            url: baseRestApiURL + "docker/" + id,
            type: 'DELETE',
            headers: {
                "Accept": "application/json",
                "Content-Type": "application/json",
                "X-Auth-Token": window.tokenKey
            }
        });
        $.when(deleteContainer)
            .done(function (deleteContResponse) {
                if(deleteContResponse && (deleteContResponse.status ==="SUCCEEDED")){
                    showMsg("Container deleted", "SUCCESS");
                    panelComp.refreshData();
                }else{
                    showMsg("Container deletion failed. "  + (typeof deleteContResponse.message !== 'undefined' ? deleteContResponse.message : ''), "ERROR");
                }
            })
            .fail(function (jqXHR, textStatus, errorThrown) {
                showMsg("Container delete failed. " + errorThrown, "ERROR");
            });
        return 1;
	}
	
	/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	$(document).ready(function () {

		var urls = [ baseRestApiURL + "docker/user" ];
		
		

		window.panelComp = $('#panel-nodes').npPaginatedCells({
			headerUser: taoUserProfile.username,
			url: urls,
			viewMode: preferences.viewMode,
			filterAttribute: "name",
			order:[
				{
					"label":"Name ascending",
					"objAttributeName":"name",
					"direction":"ASC"
				},
				{
					"label":"Name descending",
					"objAttributeName":"name",
					"direction":"DSC"
				}
			],
			doDataPreprocessing: function (data) {
				if(typeof data !== "undefined"){
					for (var i = 0; i < data.length; i ++) {
						data[i].appsCount = data[i].applications.length;
						data[i].formatCount = data[i].format.length;
						data[i].tags = [data[i].tag];
						nameListTC.push(data[i].name);
					}
				}
				return data;
			},
			doAction: function (action, args) {
				if (action === "op-plus") {
					myModalNodesOpShow(action, args);
				}
				if (action === "edit") {
					myModalNodesOpShow(action, args);
				}
				if(action === "delete"){
					$('#confirm-dialog').modal('confirm',{
						msg:"Are you sure you want to delete container <strong>"+args.dna.name+"</strong>?",
						callbackConfirm: function() {
							deleteContainerbyId(args.dna.id);
						},
						callbackCancel:function(){}
					});
					//myModalNodesOpShow(action, args);
				}
			},
			doCustomRender: function($elClone, elX) {
				// set container logo
				if (elX.logo) {
					$(".base64image", $elClone).attr("src", "data:image/jpeg;base64, " + elX.logo).removeClass("empty");
				} else {
					$(".base64image", $elClone).attr("src", "").attr("alt", " ").addClass("empty");
				}
			}
		});
	});
	//# sourceURL=containers-user.js
</script>
