<!-- modal nodes op -->
<div id="myModalNodes" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<!-- modal nodes op -->
<!-- Content Header (Page header) -->
<section class="content-header tao-async-ph">
    <h1>Remote Services<small>The list of  available processing-like <strong>modules</strong> based on external web services.</small></h1>
    <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
        <li class="active">Remote Services</li>
    </ol>
</section>
<!-- /Content Header (Page header) -->

<!-- Main content -->
<section class="content tao-async-mc">
    <div id="panel-remote-user-wrapper" class="row collapseX">
        <div class="col-md-12">
            <!-- Custom Tabs -->
            <div class="nav-tabs-custom">
                <ul class="nav nav-tabs visible-xs-block"> <!-- visible-xs-block -->
					<li class="role-dropdown active">
						<select id="selectNodePanel" name="selectNodePanel" class="form-control form-changepane" title="Select desired node view.">
							<option class="role" value="wps_nodes">WPS</option>
							<option class="role" value="wms_nodes">WMS</option>
						</select>
					</li>
				</ul>
				<ul class="nav nav-tabs hidden-xs">
					<li class="role  active"><a href="#panel-nodes" data-toggle="tab" data-action="wps_nodes" aria-expanded="true">WPS</a></li>
					<li class="role"><a href="#panel-nodes" data-toggle="tab" data-action="wms_nodes" aria-expanded="true">WMS</a></li>
				</ul>

                <div class="tab-content">
                    <div class="tab-pane active" id="panel-nodes">
                        <div class="row">
                            <div class="col-md-12" id="list-master-controls">
                                <div class="box-tools pull-left">
                                    <button class="btn btn-master-tool text-black" data-action="op-plus" data-toggle="tooltip" data-original-title="Add new web service"><i class="fa fa-plus"></i></button>
                                </div>
                                <div class="box-tools pull-left">
                                    <button class="btn btn-master-tool text-black" data-action="op-filter" data-toggle="tooltip" data-original-title="Filter by tags"><i class="fa fa-filter"></i><span class="label label-warning val-count-filters" style="display:none;">0</span></button>
                                </div>
                                <div class="box-tools pull-left">
                                    <form class="search-container collapse" action="">
                                        <input id="search-box" type="text" class="search-box" name="q" placeholder="Search by label" />
                                        <label for="search-box"><i class="fa fa-search search-icon" aria-hidden="true"></i></label>
                                        <input type="submit" id="search-submit" />
                                    </form>
                                </div>
                                <div class="box-tools pull-right">
                                    <button class="btn btn-master-tool text-black" data-action="refresh-list" data-toggle="tooltip" data-original-title="Refresh"><i class="fa fa-refresh fa-spin-hover"></i></button>
                                    <button class="btn btn-master-tool text-black" data-action="view-list" data-toggle="tooltip" data-original-title="List view"><i class="fa fa-list"></i></button>
                                    <button class="btn btn-master-tool text-black" data-action="view-table" data-toggle="tooltip" data-original-title="Grid view"><i class="fa fa-table"></i></button>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 like collapse">
                                <span data-tag="tag">Label like: <strong class="val-q"></strong>&nbsp;<i class="fa fa-times fa-fw clear-search" aria-hidden="true"></i></span>
                            </div>
                            <div class="col-md-12 tags collapse">
                                <span class="collapse" data-tag="tag">tag<i class="fa fa-check fa-fw" aria-hidden="true"></i></span>
                            </div>
                        </div>
                        <div class="row" id="list-work-users">
                            <div class="col-sm-12">
                                <div class="box box-success">
                                    <div class="box-header">
                                        <i class="fa fa-server"></i>
                                        <h3 class="box-title">Remote Services -  <span class="val-itemfrom">0</span> to <span class="val-itemto">0</span> of <span class="val-itemscount">0</span></h3>
                                        <div class="box-tools pull-right nppaginatedcells-order collapse" data-toggle="tooltip" title="Change order"></div>
                                    </div>
                                    <div class="nppaginatedcells-empty callout callout-empty">
                                        <p>List is empty. <span class="results-empty">You do not have any processing modules.</span><span class="filter-results-empty collapse">Your current selection returned no results.</span></p>
                                    </div>
                                    <div class="box-body chat users-box">
                                        <div class="nppaginatedcells-panel-body">
                                        </div>
                                        <div class="cell-templates collapse">
                                            <core-cell-list>
                                                <div class="col-md-12 col-sm-12">
                                                    <div class="nodes-item-core-box">
                                                        <div class="box-top-tags">
                                                        </div>
                                                        <div class="box-top">
                                                            <div class="box-title"><span class="val-label"></span></div>
                                                            <div class="box-subtitle"><span class="val-id"></span></div>
                                                            <div class="box-text">
																Version: <strong><span class="val-version"></span></strong> | 
																Authors: <strong><span class="val-authors"></span></strong> | 
                                                                Copyright: <strong><span class="val-copyright"></span></strong> 
                                                            </div>
                                                            <div class="box-desc">
                                                                <span class="val-description "></span>
                                                            </div>
                                                            <div class="box-icon">
                                                                <i class="fa fa-plug"></i>
                                                            </div>
                                                        </div>
                                                        <div class="row" >
                                                            <div class="col-sm-12 col-xs-12">
                                                                <div class="text-right" style="padding-top: 5px;">
                                                                    <button type="button" class="btn btn-primary btn-sm btn-flat btn-action btn-nodeop" data-action="edit" data-toggle="tooltip" data-original-title="Edit"><i class="fa fa-pencil fa-fw" aria-hidden="true"></i><span class="span-muted">&nbsp;Edit</span></button>
                                                                    <button type="button" class="btn btn-primary btn-sm btn-flat btn-action btn-nodeop" data-action="wps-start" data-toggle="tooltip" data-original-title="Start execution"><i class="fa fa-paper-plane fa-fw" aria-hidden="true"></i><span class="span-muted">&nbsp;Start execution</span></button>
																	<button type="button" class="btn btn-primary btn-sm btn-flat btn-action btn-nodeop" data-action="delete" data-toggle="tooltip" data-original-title="Remove"><i class="fa fa-trash-o fa-fw" aria-hidden="true"></i><span class="span-muted">&nbsp;Delete</span></button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </core-cell-list>
                                            <core-cell-grid>
                                                <div class="col-md-3 col-sm-6">
                                                    <div class="nodes-item-core-box">
                                                        <div class="box-top-tags">
                                                        </div>
                                                        <div class="box-top">
                                                            <div class="box-title"><span class="val-label"></span></div>
                                                            <div class="box-subtitle"><span class="val-id"></span></div>
                                                            <div class="box-text">Version:<strong> <span class="val-version"></span></strong></div>
                                                            <div class="box-text">Authors: <strong><span class="val-authors"></span></strong></div>
                                                            <div class="box-text">Copyright: <strong><span class="val-copyright"></span></strong></div>
                                                            <div class="box-desc"><span class="val-description"></span></div>
                                                            <div class="box-icon">
                                                                <i class="fa fa-plug"></i>
                                                            </div>
                                                        </div>
                                                      
                                                        <div class="box-bottom with-line">
                                                            <div class="">
                                                                <button type="button" class="btn btn-primary btn-sm btn-flat btn-action btn-nodeop" data-action="edit"><i class="fa fa-pencil fa-fw" aria-hidden="true" data-toggle="tooltip" data-original-title="Edit"></i><span class="span-muted collapse">&nbsp;Edit</span></button>
																<button type="button" class="btn btn-primary btn-sm btn-flat btn-action btn-nodeop" data-action="wps-start" data-toggle="tooltip" data-original-title="Start execution"><i class="fa fa-paper-plane fa-fw" aria-hidden="true"></i><span class="span-muted collapse">&nbsp;Start execution</span></button>
                                                                <button type="button" class="btn btn-primary btn-sm btn-flat btn-action btn-nodeop" data-action="delete" data-toggle="tooltip" data-original-title="Remove"><i class="fa fa-trash-o fa-fw" aria-hidden="true"></i><span class="span-muted collapse">&nbsp;Delete</span></button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </core-cell-grid>
                                        </div>
                                    </div>
                                    <div class="box-footer clearfix no-border">
                                        <div class="box-tools pull-right">
                                            <ul class="nppaginatedcells-panel-pagination pagination pagination-sm inline">
                                                <li><a href="#" data-page="prev">«</a></li>
                                                <li class="active"><a href="#" data-page="0">1</a></li>
                                                <li><a href="#" data-page="1">2</a></li>
                                                <li><a href="#" data-page="2">3</a></li>
                                                <li><a href="#" data-page="next">»</a></li>
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="box-notification"><p><span>List updated</span></p></div>
                                </div>
                            </div>
                        </div>
                    </div><!-- /.tab-pane -->

                    <div class="tab-pane" id="panel-nodesX">
                    </div><!-- /.tab-pane -->

                </div><!-- /.tab-content -->
            </div><!-- nav-tabs-custom -->
        </div>
    </div>
</section><!-- /.content -->
<script>
    var nameListRSU = [];
    deleteRemoteServiceById = function(id, urls){
        $.ajax({
            cache: false,
            url: urls +"?id="+ id,
            type: 'DELETE',
			processData: false,
            headers: {
                "X-Auth-Token": window.tokenKey
            },
            error : function (jqXHR, textStatus, errorThrown) {
                if(jqXHR.status === 500 ){
                    showMsg("Unable to delete node. Please try again.", "ERROR");
                } else {
                    showMsg("An error has occurred, please try again or contact app admin.", "ERROR");
                }
            },
            success: function(data) {
				if(data.status !== responseStatus.success) {
					if (typeof data.message != "undefined" && data.message !== null && data.message !== "") {
						showMsg(data.message, "ERROR");
					} else {
						showMsg("An error has occurred, please try again or contact app admin.", "ERROR");
					}
				} else {
					showMsg("Processing component successfully deleted.", "SUCCESS");
					panelRemoteServices.refreshData();
				}
            }
        });
    };

    myModalNodesOpShow = function(operationid, args){
        var $modal = $("#myModalNodes");
        $(".modal-dialog",$modal).removeClass("modal-lg");
        var rm_contentUrl = '';
        var rmContent = '';
        window.userOpStack = [];

        if(operationid === "op-plus"){
            $(".modal-dialog",$modal).addClass("modal-lg");
            rm_contentUrl="./fragments/remoteServices-components-plus.fragment.html?" + Math.random();
        }
        if(operationid === "edit"){
            window.userOpStack = [{
                "dna": args.dna,
                "action": "wps_edit"
            }];
            $(".modal-dialog",$modal).addClass("modal-lg");
            rm_contentUrl="./fragments/remoteServices-components-plus.fragment.html?" + Math.random();
        }
		if(operationid === "wps-start"){
            window.userOpStack = [{
                "dna":args.dna,
                "action":"wps_edit"
            }];
            $(".modal-dialog",$modal).addClass("modal-lg");
            rm_contentUrl="./fragments/remoteServices-components-start.fragment.html?" + Math.random();
        }
        if(rm_contentUrl === ''){
            alert("AVL - Operation mismatch");
            return;
        }
        $.ajax({
            url: rm_contentUrl,
            success: function(result) {
                rmContent = result;
                if(rmContent !== ''){
                    $modal.find('.modal-dialog').first().html(rmContent);
                }else{
                    alert("Could not retrive needed data from server.");
                    return e.preventDefault();
                }
                $modal.modal('show');
            }
        });
    };

    $( document ).ready(function() {

        var url;
		var urls = [baseRestApiURL +  "wpscomponent/"];
		$("a[data-toggle='tab']", "#panel-remote-user-wrapper").on("shown.bs.tab", function (e) {
			var action = $(this).data("action");
			if (action === "wps_nodes") {
                url = baseRestApiURL +  "wpscomponent/";
            }else if(action === "wms_nodes"){
				url = baseRestApiURL +  "wmscomponent/";
			}
            urls = [ url ];
			window.panelRemoteServices.refreshData(urls);
		});
       
		
		window.panelRemoteServices = $("#panel-nodes").npPaginatedCells({
			headerUser: taoUserProfile.username,
			url: urls,
			viewMode: preferences.viewMode,
			filterAttribute: "label",
			order:[
				{
					"label":"Name ascending",
					"objAttributeName":"label",
					"direction":"ASC"
				},
				{
					"label":"Name descending",
					"objAttributeName":"label",
					"direction":"DSC"
				}
			],
            doDataPreprocessing: function (data) {
				for (var i = 0; i < data.length; i ++) {
					data[i].paramCount = data[i].parameters.length;
					data[i].sourcesCount = data[i].sources.length;
                    data[i].targetsCount = data[i].targets.length;
					//data[i].tags = [data[i].tag];
					nameListRSU.push(data[i].label);
				}
				return data;
			},
			doAction: function(action, args){
				if(action === "op-plus"){
					// if( taoUserProfile.userRole !== "ADMIN"){
					// 	showMsg("Only admin roles can add remote services.", "ERROR");
					// 	return;
					// }
					myModalNodesOpShow(action, args);
				}
				if((action === "edit") || (action === "wps-start")) myModalNodesOpShow(action, args);
				if(action === "delete"){
					// if( taoUserProfile.userRole !== "ADMIN"){
					// 	alert("not allowed");
					// 	return;
					// }
					$('#confirm-dialog').modal('confirm',{
						msg:"Are you sure you want to delete the remote service: <strong>"+args.dna.label+"</strong>?",
						callbackConfirm: function() {
							deleteRemoteServiceById(args.dna.id, urls);
						},
						callbackCancel:function(){}
					});
				}
			}
		});
		//contextual location based variations
		
		if (taoUserProfile.userRole !== "ADMIN") {
			$("#list-master-controls").find("button[data-action='op-plus']").hide();
			$("#list-work-users").find("button[data-action='delete']").hide();
		}
    });
    //# sourceURL=remoteServices-components.js
</script>
