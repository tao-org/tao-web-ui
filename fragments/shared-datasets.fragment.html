<style>
	#confirm-dialog .body-message { word-break: break-word }
	.nodes-item-core-box .box-top .box-text{line-height:1.3em;white-space:nowrap;overflow:hidden}
	.nodes-item-core-box .box-description{background:#e3f3fc;padding:5px 15px;margin:10px -15px 10px -15px;line-height:1.2em;color:#555}
	.nodes-item-core-box .box-bottom{padding:0}
	@media (min-width: 992px){.modal-width{width: 1300px;}}
	img.base64image{position:relative;display:block;width:100px;height:100px;margin:5px 0 0 0;border-radius:15px;background-color:white;padding:5px;box-shadow:3px 3px 5px 0 rgba(51, 51, 51, 0.12);border-bottom:2px solid #3c8dbc}
	img.base64image.empty{box-shadow:none;border:0}
	img.base64image.empty::before{content:" ";position:absolute;display:block;width:100%;height:100%;background-color:white}
	img.base64image.empty::after{content:" ";position:absolute;display:block;width:94px;height:94px;border-radius:15px;background-repeat:no-repeat;background-color:white;background-image:url(../media/images/preview-not-available.png);background-position:center;box-shadow:3px 3px 5px 0 rgba(51, 51, 51, 0.12);border-bottom:2px solid #3c8dbc}
</style>

<!-- modal nodes op -->
<div id="myModalNodes" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
	</div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<!-- modal nodes op -->


<!-- modal nodes container descriptor -->
<div id="myModalNodesContDesc" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
	</div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<!-- modal nodes op -->


<!-- modal nodes component descriptor -->
<div id="myModalNodesCompDesc" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
	</div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<!-- modal nodes op -->



<!-- Content Header (Page header) -->
<section class="content-header tao-async-ph">
	<h1>Shared Datasets <small> The list of <strong>datasets</strong> that are shared with other users of the platform.</small></h1>
	<ol class="breadcrumb">
		<li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
		<li class="active">Shared Datasets</li>
	</ol>
</section>
<!-- /Content Header (Page header) -->
<!-- Main content -->
<section class="content tao-async-mc">
	<div id="panel-topo-wrapper" class="row collapseX">
		<div class="col-md-12">
			<!-- Custom Tabs -->
			<div class="nav-tabs-custom">
				<ul class="nav nav-tabs visible-xs-block"> <!-- visible-xs-block -->
					<!--li class="role-dropdown active">
						<select id="selectNodePanel" name="selectNodePanel" class="form-control form-changepane" title="Select desired node view.">
							<option class="role role-admin" value="active_nodes">Online nodes</option>
						</select>
					</li-->
				</ul>
				<ul class="nav nav-tabs hidden-xs">
					<!--li class="role role-admin active"><a href="#panel-nodes" data-toggle="tab" data-action="active_nodes" aria-expanded="true">Toolbox container</a></li-->
				</ul>
				
				<div class="tab-content">
					<div class="tab-pane active" id="panel-nodes">
						<div class="row">
							<div class="col-md-12" id="list-master-controls">
								
								<div class="box-tools pull-left">
									<button class="btn btn-master-tool text-black" data-action="op-filter" data-toggle="tooltip" data-original-title="Filter by tags"><i class="fa fa-filter"></i><span class="label label-warning val-count-filters" style="display:none;">0</span></button>
								</div>
								<div class="box-tools pull-left">
									<form class="search-container collapse" action="">
										<input id="search-box" type="text" class="search-box" name="q" placeholder="Search by label" />
										<label for="search-box"><i class="fa fa-search search-icon" aria-hidden="true"></i></label>
										<input type="submit" id="search-submit" />
									</form>
								</div>
								<div class="box-tools pull-right">
									<button class="btn btn-master-tool text-black" data-action="refresh-list" data-toggle="tooltip" data-original-title="Refresh"><i class="fa fa-refresh fa-spin-hover"></i></button>
									<button class="btn btn-master-tool text-black" data-action="view-list" data-toggle="tooltip" data-original-title="List view"><i class="fa fa-list"></i></button>
									<button class="btn btn-master-tool text-black" data-action="view-table" data-toggle="tooltip" data-original-title="Grid view"><i class="fa fa-table"></i></button>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="col-md-12 like collapse">
								<span data-tag="tag">Label like: <strong class="val-q"></strong>&nbsp;<i class="fa fa-times fa-fw clear-search" aria-hidden="true"></i></span>
							</div>
							<div class="col-md-12 tags collapse">
								<span class="collapse" data-tag="tag">tag<i class="fa fa-check fa-fw" aria-hidden="true"></i></span>
							</div>
						</div>
						<div class="row" id="list-work-users">
							<div class="col-sm-12">
								<div class="box box-success">
									<div class="box-header">
										<i class="fa fa-th-large" aria-hidden="true"></i>
										<h3 class="box-title">Shared  datasets -  <span class="val-itemfrom">0</span> to <span class="val-itemto">0</span> of <span class="val-itemscount">0</span></h3>
										<div class="box-tools pull-right nppaginatedcells-order collapse" data-toggle="tooltip" title="Change order"></div>
									</div>
									<div class="nppaginatedcells-empty callout callout-empty">
										<p>List is empty. <span class="results-empty">You do not have any shared datasets.</span><span class="filter-results-empty collapse">Your current selection returned no results.</span></p>
									</div>
									<div class="box-body chat users-box">
										<div class="nppaginatedcells-panel-body"></div>
										<div class="cell-templates collapse">
											<core-cell-list>
												<div class="col-md-12 col-sm-12">
													<div class="nodes-item-core-box">
														<div class="box-top-tags">
															<span>Tag1</span><span>Tag2</span><span>Tag3</span>
														</div>
														<div class="box-top">
															<div class="box-title"><span class="val-name"> Lynx Node </span></div>
															<div class="box-text">
																Created: <strong><span class="val-created"> - </span></strong> | 
																Subscribers: <strong><span class="val-subscribers"> 0 </span></strong> |
																Root path: <strong><span class="val-dataRootPath"> - </span></strong>
															</div>
														</div>
														<!-- <div class="box-description row"><span class="val-description"> Description </span></div> -->
														<div class="row">
															<div class="col-md-6 col-sm-12 col-xs-12">
																<button type="button" class="btn btn-primary btn-sm btn-flat btn-action btn-nodeop" data-action="unshare"><i class="fa fa-trash-o fa-fw" aria-hidden="true"></i><span class="span-muted collapse">&nbsp;Delete</span></button>
															</div>
														</div>
													</div>
												</div>
											</core-cell-list>
											<core-cell-grid>
												<div class="col-lg-3 col-md-4 col-sm-6">
													<div class="nodes-item-core-box">
														<div class="box-top-tags">
															<span>Tag1</span><span>Tag2</span><span>Tag3</span>
														</div>
														<div class="box-top">
															<div class="box-title"><span class="val-name"> Lynx Node </span></div>
															<div class="box-text">
																Created:<strong> <span class="val-created"></span></strong><br/>
																Subscribers: <strong><span class="val-subscribers"> 0 </span></strong><br/>
                                                            	Root path: <strong><span class="val-dataRootPath"></span></strong>
															</div>
														</div>
														<!-- <div class="box-description"><span class="val-description"> Description </span></div> -->
														<div class="box-bottom">
															<div class="text-left">
																<button type="button" class="btn btn-primary btn-sm btn-flat btn-action btn-nodeop" data-action="unshare"><i class="fa fa-trash-o fa-fw" aria-hidden="true"></i><span class="span-muted collapse">&nbsp;Delete</span></button>
															</div>
														</div>
													</div>
												</div>
											</core-cell-grid>
										</div>
									</div>
									<div class="box-footer clearfix no-border">
										<div class="box-tools pull-right">
											<ul class="nppaginatedcells-panel-pagination pagination pagination-sm inline">
												<li><a href="#" data-page="prev">«</a></li>
												<li class="active"><a href="#" data-page="0">1</a></li>
												<li><a href="#" data-page="1">2</a></li>
												<li><a href="#" data-page="2">3</a></li>
												<li><a href="#" data-page="next">»</a></li>
											</ul>
										</div>
									</div>
									<div class="box-notification"><p><span>List updated</span></p></div>
								</div>
							</div>
						</div>
					</div><!-- /.tab-pane -->
					
					<div class="tab-pane" id="panel-nodesX">
					</div><!-- /.tab-pane -->
					
				</div><!-- /.tab-content -->
			</div><!-- nav-tabs-custom -->
		</div>
	</div>
</section><!-- /.content -->


<link rel="stylesheet" href="./assets/libs/jQuery-datepicker/jquery-ui.theme.css" type="text/css" />
<link rel="stylesheet" href="./assets/libs/jQuery-datepicker/jquery-ui.structure.css" type="text/css" />
<link rel="stylesheet" href="./assets/libs/jQuery-datepicker/jquery-ui.css" type="text/css" />

<script src="./assets/libs/jQuery-datepicker/jquery-ui.js" type="text/javascript"></script>
<script type="text/javascript" src="./assets/libs/openlayers/ol-poly.js"></script>

<script>

	unshareDataset = function(name){
		$.ajax({
			cache: false,
			url: baseRestApiURL + "files/unshare?name=" + name,
			type: 'POST',
			headers: {
				"Accept": "application/json",
				"Content-Type": "application/json",
				"X-Auth-Token": window.tokenKey
			},
			error : function (jqXHR, textStatus, errorThrown) {
				console.log("error");
				if(jqXHR.status === 500 ){
					showMsg("Unable to remove share. Please try again.", "ERROR");
				} else {
					alert('An error has occurred, please try again or contact app admin.');
				}
			},
			success: function(response) {
				if(response.status === "SUCCEEDED"){
					showMsg("Product set successfully unshared.", "SUCCESS");
				}else{
					showMsg("An error has occured. Could not remove dataset.", response.status);
				}
				panelComp.refreshData();
			}
		});
	};

	
	/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	$(document).ready(function () {
		var urls = [ baseRestApiURL + "files/share/list" ];
		window.panelComp = $('#panel-nodes').npPaginatedCells({
			headerUser: taoUserProfile.username,
			url: urls,
			viewMode: preferences.viewMode,
			filterAttribute: "name",
			order:[
				{
					"label":"Name ascending",
					"objAttributeName":"name",
					"direction":"ASC"
				},
				{
					"label":"Name descending",
					"objAttributeName":"name",
					"direction":"DSC"
				}
			],
			doDataPreprocessing: function (data) {
				// for (var i = 0; i < data.length; i ++) {
				// }
				$.each(data, function(index, element){
					if(typeof element.created !== "undefined"){
						var date = element.created.split('.');
						date[0] = date[0].replace("T", ' ');
						element.created = date[0];
					}
				})
				return data;
			},
			doAction: function (action, args) {

				if(action === "unshare"){
					
					$('#confirm-dialog').modal('confirm',{
						msg:"Are you sure you want to unshare the dataset: <strong>"+args.dna.name+"</strong>?",
						callbackConfirm: function() {
							unshareDataset(args.dna.name);
						},
						callbackCancel:function(){}
					});
				}
			},
			
		});
	});

	//# sourceURL=shared-datasets.js
</script>
