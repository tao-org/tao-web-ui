<!-- modal nodes op -->
<div id="myModalNodes" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<!-- modal nodes op -->

<!-- Content Workflow -->
<section id="tao-async-wf" class="content tao-async-wf collapse">
    <div class="row">
        <div class="col-md-12">
            <iframe id="WorkflowBuilder"
                    title="WorkflowBuilder"
                    width="100%"
                    height="1050"
                    frameborder="0"
                    scrolling="no"
                    marginheight="0"
                    marginwidth="0"
                    src="./workflow/">
            </iframe>
        </div>
    </div>
</section>
<!-- /Content Workflow -->



<!-- Content Header (Page header) -->
<section class="content-header tao-async-ph">
    <h1>Workflows <small>Full list of <strong>Workflows</strong> grouped by current state.</small></h1>
    <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
        <li class="active">Workflows</li>
    </ol>
</section>
<!-- /Content Header (Page header) -->

<!-- Main content -->
<section class="content tao-async-mc">
    <div id="panel-topo-wrapper" class="row collapseX">
        <div class="col-md-12">
            <!-- Custom Tabs -->
            <div class="nav-tabs-custom">
                <ul class="nav nav-tabs visible-xs-block"> <!-- visible-xs-block -->
                    <li class="role-dropdown active">
                        <select id="selectUserPanel" name="selectUserPanel" class="form-control form-changepane" title="Select desired node view.">
                            <option class="role role-admin" value="all_nodes">All workflows </option>
                            <option class="role role-admin" value="disabled_nodes">Active workflows</option>
                        </select>
                    </li>
                    <li class="pull-right">
                        <a href="#" class="btn text-muted btn-action" data-action="refresh" data-toggle="tooltip" title="" data-original-title="Refresh"><i class="fa fa-refresh"></i></a>
                    </li>
                </ul>
                <ul class="nav nav-tabs hidden-xs">
                    <li class="role role-admin active"><a href="#panel-nodes" data-toggle="tab" data-action="all_nodes" aria-expanded="true">All workflows</a></li>
                    <li class="role role-admin"><a href="#panel-nodesX" data-toggle="tab" data-action="disabled_nodes" aria-expanded="false">Active workflows</a></li>
                    <li class="pull-right">
                        <a href="#" class="btn text-muted btn-action" data-action="refresh" data-toggle="tooltip" title="" data-original-title="Refresh"><i class="fa fa-refresh"></i></a>
                    </li>
                </ul>

                <div class="tab-content">
                    <div class="tab-pane active" id="panel-nodes">
                        <div class="row">
                            <div class="col-md-12 div-loading collapse">
                                <div class="box box-default box-solid">
                                    <div class="box-header">
                                        <h3 class="box-title">Loading ...</h3>
                                    </div>
                                    <div class="box-body">
                                        Workflows list will load soon ...
                                    </div><!-- /.box-body -->
                                    <!-- Loading (remove the following to stop the loading)-->
                                    <div class="overlay">
                                        <i class="fa fa-refresh fa-spin"></i>
                                    </div>
                                    <!-- end loading -->
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12" id="list-master-controls">
                                <div class="box-tools pull-left">
                                    <button class="btn btn-master-tool text-black" data-action="op-plus" data-toggle="tooltip" data-original-title="Add a new user"><i class="fa fa-plus"></i></button>
                                </div>
                                <div class="box-tools pull-left">
                                    <button class="btn btn-master-tool text-black" data-action="op-filter" data-toggle="tooltip" data-original-title="Filter by tags"><i class="fa fa-filter"></i><span class="label label-warning val-count-filters" style="display:none;">0</span></button>
                                </div>
                                <div class="box-tools pull-left">
                                    <form class="search-container" action="">
                                        <input id="search-box" type="text" class="search-box" name="q" placeholder="Search by workflow name" />
                                        <label for="search-box"><i class="fa fa-search search-icon" aria-hidden="true"></i></label>
                                        <input type="submit" id="search-submit" />
                                    </form>
                                </div>
                                <div class="box-tools pull-right">
                                    <button class="btn btn-master-tool text-black" data-action="view-list" data-toggle="tooltip" data-original-title="List view"><i class="fa fa-list"></i></button>
                                    <button class="btn btn-master-tool text-black" data-action="view-table" data-toggle="tooltip" data-original-title="Table view"><i class="fa fa-table"></i></button>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 like collapse">
                                <span data-tag="tag">Workflow name like: <strong class="val-q"></strong>&nbsp;<i class="fa fa-times fa-fw clear-search" aria-hidden="true"></i></span>
                            </div>
                            <div class="col-md-12 tags collapse">
                                <span class="collapse" data-tag="tag">tag<i class="fa fa-check fa-fw" aria-hidden="true"></i></span>
                            </div>
                        </div>
                        <div class="row" id="list-work-users">
                            <div class="col-sm-12">
                                <div class="box box-success">
                                    <div class="box-header empty">
                                        <i class="fa fa-server"></i>
                                        <h3 class="box-title">List is empty.</h3>
                                    </div>
                                    <div class="box-header not-empty">
                                        <i class="fa fa-server"></i>
                                        <h3 class="box-title">Workflows -  <span class="val-itemfrom">0</span> to <span class="val-itemto">0</span> of <span class="val-itemscount">0</span></h3>
                                        <div class="box-tools pull-right" data-toggle="tooltip" title="Status">
                                            <p>Order by:</p>
                                        </div>
                                    </div>
                                    <div class="box-body chat users-box" id="nodes-box">
                                    </div>
                                    <div class="box-footer clearfix no-border">
                                        <div class="box-tools pull-right">
                                            <ul class="pagination pagination-sm inline">
                                                <li><a href="#" data-page="prev">«</a></li>
                                                <li class="active"><a href="#" data-page="0">1</a></li>
                                                <li><a href="#" data-page="1">2</a></li>
                                                <li><a href="#" data-page="2">3</a></li>
                                                <li><a href="#" data-page="next">»</a></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div><!-- /.tab-pane -->

                    <div class="tab-pane" id="panel-nodesX">
                        <div class="row">
                            <div class="col-md-12 div-loading collapse" style="display: none;">
                                <div class="box box-default box-solid">
                                    <div class="box-header">
                                        <h3 class="box-title">Loading ...</h3>
                                    </div>
                                    <div class="box-body">
                                        Loading list. Please wait.
                                    </div><!-- /.box-body -->
                                    <!-- Loading (remove the following to stop the loading)-->
                                    <div class="overlay">
                                        <i class="fa fa-refresh fa-spin"></i>
                                    </div>
                                    <!-- end loading -->
                                </div>
                            </div>
                        </div>
                        <div class="row hidden">
                            <core-node-box id="node-master-template" class="collapse">
                                <div class="col-md-3 col-sm-6">
                                    <div class="nodes-item-core-box">
                                        <div class="box-top-tags">
                                            <span>Tag1</span><span>Tag2</span><span>Tag3</span>
                                        </div>
                                        <div class="box-top">
                                            <div class="box-title space-after-10"><span class="val-wnm"> Lynx Node </span></div>
                                            <div class="box-text">User:&nbsp;<span class="val-wuser">creation date</span></div>
                                            <div class="">Created:&nbsp;<span class="val-wcdate">creation date</span></div>
                                            <div class="">Visibility:&nbsp<span class="val-wvisibility"></span></div>
                                            <div class="">Status:&nbsp<span class="val-wstatus"></span></div>
                                            <div class="">Active:&nbsp<span class="val-wactive"></span></div>
                                            <div class="space-after-10">Path:&nbsp<span class="val-wpath"></span></div>
                                            <div class="box-icon">
                                                <i class="fa fa-random"></i>
                                            </div>
                                        </div>
                                        <div class="box-bottom with-line">
                                            <div class="">
                                                <button type="button" class="btn btn-primary btn-sm btn-flat btn-action btn-nodeop" data-action="wf-edit"><i class="fa fa-pencil fa-fw" aria-hidden="true"></i><span class="span-muted">&nbsp;Edit</span></button>
                                                <button type="button" class="btn btn-primary btn-sm btn-flat btn-action btn-nodeop disabled" data-action="op-5"><i class="fa fa-random fa-fw" aria-hidden="true"></i><span class="span-muted">&nbsp;Clone</span></button>
                                                <button type="button" class="btn btn-primary btn-sm btn-flat btn-action btn-nodeop disabled" data-action="op-2"><i class="fa fa-check fa-fw" aria-hidden="true"></i><span class="span-muted">&nbsp;Validate</span></button>
                                                <button type="button" class="btn btn-primary btn-sm btn-flat btn-action btn-nodeop disabled" data-action="op-2"><i class="fa fa-paper-plane fa-fw" aria-hidden="true"></i><span class="span-muted">&nbsp;Start execution</span></button>
                                                <button type="button" class="btn btn-primary btn-sm btn-flat btn-action btn-nodeop disabled" data-action="op-pause-resume"><i class="fa fa-pause fa-fw" aria-hidden="true"></i><span class="span-muted"> Pause / resume execution</span></button>
                                                <button type="button" class="btn btn-primary btn-sm btn-flat btn-action btn-nodeop disabled" data-action="op-publish"><i class="fa fa-bullhorn fa-fw" aria-hidden="true"></i><span class="span-muted">&nbsp;Publish current workflow</span></button>
                                                <button type="button" class="btn btn-primary btn-sm btn-flat btn-action btn-nodeop disabled" data-action="delete"><i class="fa fa-trash-o fa-fw" aria-hidden="true"></i><span class="span-muted">&nbsp;Delete workflow</span></button>
                                                <button type="button" class="btn btn-primary btn-sm btn-flat btn-action btn-nodeop" data-action="view-results"><i class="fa fa-picture-o fa-fw" aria-hidden="true"></i><span class="span-muted">&nbsp;Show execution results</span></button>
                                                <button type="button" class="btn btn-primary btn-sm btn-flat btn-action btn-nodeop" data-action="trace-execution"><i class="fa fa-road fa-fw" aria-hidden="true"></i><span class="span-muted">&nbsp;Trace execution</span></button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </core-node-box>
<!-- project template -->
                            <core-node-box id="node-master-template-list" class="collapse">
                            <div class="col-md-12 proj-element">
                                <div class="node-tools pull-right">
                                    <span data-toggle="tooltip" title="" class="badge bg-black" data-original-title="3 notifications">3</span>
                                    <button class="btn btn-box-tool wf-edit text-black btn-action" data-action="wf-edit" data-toggle="tooltip" data-original-title="Edit workflow">
		<span class="value-dependent value-1 collapse">
			<span class="fa-stack fa-lg">
				<i class="fa fa-circle fa-stack-2x text-green" style=""></i>
				<i class="fa fa-pencil fa-stack-1x fa-inverse"></i>
			</span>
		</span>
                                        <span class="value-dependent value-0 collapse">
			<span class="fa-stack fa-lg">
				<i class="fa fa-pencil fa-stack-1x"></i>
				<i class="fa fa-ban fa-stack-2x text-danger"></i>
			</span>
		</span>
                                        <span class="value-dependent value-default">
			<span class="fa-stack fa-lg value-dependent value-default">
				<i class="fa fa-pencil"></i>
			</span>
		</span>
                                    </button>
                                    <button class="btn btn-box-tool op-5 text-black btn-action disabled" data-action="op-5" data-toggle="tooltip" data-original-title="Clone workflow">
		<span class="value-dependent value-1 collapse">
			<span class="fa-stack fa-lg">
				<i class="fa fa-circle fa-stack-2x text-green" style=""></i>
				<i class="fa fa-random fa-stack-1x fa-inverse"></i>
			</span>
		</span>
                                        <span class="value-dependent value-0 collapse">
			<span class="fa-stack fa-lg">
				<i class="fa-random fa-stack-1x"></i>
				<i class="fa fa-ban fa-stack-2x text-danger"></i>
			</span>
		</span>
                                        <span class="value-dependent value-default">
			<span class="fa-stack fa-lg value-dependent value-default">
				<i class="fa fa-random"></i>
			</span>
		</span>
                                        <span class="label value-copies collapse bg-black"></span>
                                    </button>
                                    <button class="btn btn-box-tool op-2 text-black btn-action disabled " data-action="op-2" data-toggle="tooltip" data-original-title="Validate workflow">
		<span class="value-dependent value-1 collapse">
			<span class="fa-stack fa-lg">
				<i class="fa fa-circle fa-stack-2x text-green" style=""></i>
				<i class="fa fa-check fa-stack-1x fa-inverse"></i>
			</span>
		</span>
                                        <span class="value-dependent value-0 collapse">
			<span class="fa-stack fa-lg">
				<i class="fa fa-check fa-stack-1x"></i>
				<i class="fa fa-ban fa-stack-2x text-danger"></i>
			</span>
		</span>
                                        <span class="value-dependent value-default">
			<span class="fa-stack fa-lg value-dependent value-default">
				<i class="fa fa-check"></i>
			</span>
		</span>
                                    </button>
                                    <button class="btn btn-box-tool op-20 text-black btn-action disabled" data-action="op-20" data-toggle="tooltip" data-original-title="Deploy and start execution">
		<span class="value-dependent value-1 collapse">
			<span class="fa-stack fa-lg">
				<i class="fa fa-circle fa-stack-2x text-green" style=""></i>
				<i class="fa fa-paper-plane fa-stack-1x fa-inverse"></i>
			</span>
		</span>
                                        <span class="value-dependent value-0 collapse">
			<span class="fa-stack fa-lg">
				<i class="fa fa-paper-plane fa-stack-1x"></i>
				<i class="fa fa-ban fa-stack-2x text-danger"></i>
			</span>
		</span>
                                        <span class="value-dependent value-default">
			<span class="fa-stack fa-lg value-dependent value-default">
				<i class="fa fa-paper-plane"></i>
			</span>
		</span>
                                    </button>
                                    <button class="btn btn-box-tool op-2 text-black btn-action disabled " data-action="op-pause-resume" data-toggle="tooltip" data-original-title="Pause / resume execution">
		<span class="value-dependent value-1 collapse">
			<span class="fa-stack fa-lg">
				<i class="fa fa-circle fa-stack-2x text-green" style=""></i>
				<i class="fa fa-pause fa-stack-1x fa-inverse"></i>
			</span>
		</span>
                                        <span class="value-dependent value-0 collapse">
			<span class="fa-stack fa-lg">
				<i class="fa fa-play fa-stack-1x"></i>
				<i class="fa fa-ban fa-stack-2x text-danger"></i>
			</span>
		</span>
                                        <span class="value-dependent value-default">
			<span class="fa-stack fa-lg value-dependent value-default">
				<i class="fa fa-pause"></i>
			</span>
		</span>
                                    </button>
                                    <button class="btn btn-box-tool op-6 text-black btn-action disabled " data-action="op-6" data-toggle="tooltip" data-original-title="Publish current workflow">
		<span class="value-dependent value-default">
			<span class="fa-stack fa-lg value-dependent value-default">
				<i class="fa fa-bullhorn"></i>
			</span>
		</span>
                                    </button>
                                    <button class="btn btn-box-tool op-6 text-black btn-action disabled " data-action="op-delete" data-toggle="tooltip" data-original-title="Delete current workflow">
		<span class="value-dependent value-default">
			<span class="fa-stack fa-lg value-dependent value-default">
				<i class="fa fa-trash-o"></i>
			</span>
		</span>
                                    </button>
                                    <button class="btn btn-box-tool text-black btn-action" data-action="view-results" data-toggle="tooltip" data-original-title="Show execution results">
		<span class="value-dependent value-default">
			<span class="fa-stack fa-lg value-dependent value-default">
				<i class="fa fa-picture-o"></i>
			</span>
		</span>
                                    </button>
                                    <button class="btn btn-box-tool text-black btn-action" data-action="trace-execution" data-toggle="tooltip" data-original-title="Trace execution">
		<span class="value-dependent value-default">
			<span class="fa-stack fa-lg value-dependent value-default">
				<i class="fa fa-road"></i>
			</span>
		</span>
                                    </button>
                                </div>
                                <div class="tranz01 nodes-item-core-box">
                                    <div class="box-top-tags">
                                        <span>Tag1</span><span>Tag2</span><span>Tag3</span>
                                    </div>
                                    <div class="info-box-select">
		<span class="fa-stack">
			<i class="fa fa-random fa-stack-2x"></i>
		</span>
                                    </div>
                                    <div class="project-box-body">
                                        <p class="nopadding">
                                            <span class="val-project-title val-wnm">No Name Workflow</span>
                                            <span class="info-box-tags">
						                        <small class="label bg-green">running</small>
						                        <small class="tag-flag">failed</small>
					                        </span>
                                        </p>
                                        <span class="info-box-initiator val-owner val-wuser">userName</span>
                                        <div class="progress">
                                            <div class="progress-bar progress-bar-primary progress-bar-striped" style="width: 50%"></div>
                                        </div>
                                        <p CLASS="info-box-prop">
                                            Created:&nbsp;<span class="info-box-date-arrival val-wcdate">01.01.2017</span>
                                            , visibility:&nbsp;<span class="info-box-date-arrival val-wvisibility"></span>
                                            , status:&nbsp;<span class="info-box-date-arrival val-wstatus"></span>
                                            , active:&nbsp;<span class="info-box-date-arrival val-wactive"></span>
                                            , path:&nbsp;<span class="info-box-date-arrival val-wpath"></span>
                                        </p>
                                        <div class="collapse">
                                            last edited on <span class="info-box-date-end val-edatep">00.00.0000</span>,
                                            <span class="info-box-date-days">26 hours ago</span>, completed: <span class="info-box-completed">50%</span>
                                            <span class="val-project-description">Description...</span>
                                        </div>
                                    </div><!-- /.info-box-content -->
                                </div><!-- /.info-box -->
                            </div>
                            </core-node-box>
<!-- /.project template -->




























                        </div>

                        <div class="row">
                        </div>
                    </div><!-- /.tab-pane -->

                </div><!-- /.tab-content -->
            </div><!-- nav-tabs-custom -->
        </div>
    </div>
</section><!-- /.content -->
<script>
    if(_mLIST){
        for (var member in _mLIST) delete _mLIST[member];
    }
    var _mLIST =
        {
            $el:{
                wrapp: $("#panel-topo-wrapper"),
                itemsBox: $("#nodes-box"),
                tags: $(".tags"),
                pagination: $(".pagination",$("#nodes-box").next()),
                valItemFrom: $(".val-itemfrom"),
                valItemTo: $(".val-itemto"),
                valItemCount: $(".val-itemscount"),
                like: $(".like"),
                searchBox: $(".search-box",$("#panel-topo-wrapper")),
                valCountFilters: $(".val-count-filters")
            },
            dataFull:[],
            dataAllTags: [],
            data: [],
            dataOpQueue: [],
            dataFilter : {
                selectedTags: [],
                searchString: ""
            },
            dataPagination : {
                active: true,
                directPagesNo:3,
                itemsOnPage: 8,
                currentPage: 0
            },
            dataStatistics : "",
            refresh: function(){
                _mLIST.dataOpQueue = [];
                _mLIST.clearList();
                routeLoading('show');
                //_mLIST.showLoading();
                setTimeout(function(){
                    _mLIST.getData();
                },200);
            },
            repaint: function(){
                _mLIST.filterData();
                _mLIST.repaintPagination();
                _mLIST.repaintList();
            },
            filterData: function(){
                _mLIST.data = [];
                _mLIST.dataFilter.selectedTags = [];
                $("span.selected",_mLIST.$el.tags).each(function() {
                    _mLIST.dataFilter.selectedTags.push($( this ).data('tag'));
                });
                //filter by tags
                for (var j = 0; j < _mLIST.dataFull.length; j++){
                    //
                    var tagsIntersecttion = arrayIntersection(_mLIST.dataFilter.selectedTags,_mLIST.dataFull[j].tags);
                    if ((_mLIST.dataFilter.selectedTags.length === 0) || (tagsIntersecttion.length>0)){
                        _mLIST.data.push(_mLIST.dataFull[j]);
                    }
                }
                //filter by text
                _mLIST.dataFilter.searchString = _mLIST.$el.searchBox.val();
                console.log("filter:");
                console.log(_mLIST.dataFilter.searchString);
                if (_mLIST.dataFilter.searchString !== ''){
                    var re = new RegExp(_mLIST.dataFilter.searchString, 'i');
                    _mLIST.data = $.map(_mLIST.data,function(val,key){
                        if( val.name.match(re) ) return val;
                    });
                }
            },
            repaintTags: function(){
                _mLIST.$el.tags.empty();
                if(_mLIST.dataAllTags.length === 0 ){
                    _mLIST.$el.tags.append('<p>No tags to show.</p>');
                }
                for (var j = 0; j < _mLIST.dataAllTags.length; j++){
                    _mLIST.$el.tags.append('<span class="'+ (( $.inArray(_mLIST.dataAllTags[j], _mLIST.dataFilter.selectedTags)>=0) ? "selected" : "") +'" data-tag="'+_mLIST.dataAllTags[j]+'">'+_mLIST.dataAllTags[j]+'<i class="selected-hidden fa fa-square-o fa-fw" aria-hidden="true"></i><i class="selected-shown fa fa-check-square-o fa-fw" aria-hidden="true"></i></span>');
                }
            },
            repaintPagination: function(reqPage){
                var tP = Math.ceil(parseFloat(_mLIST.data.length/_mLIST.dataPagination.itemsOnPage) || 0);
                var p = 0;
                if(isNaN(reqPage)){
                    p = _mLIST.dataPagination.currentPage;
                } else{
                    p = parseInt(reqPage);
                }
                if(p > tP){
                    p = tP;
                }
                _mLIST.dataPagination.currentPage = p;
                var fP = p - _mLIST.dataPagination.directPagesNo;
                var lP = p + _mLIST.dataPagination.directPagesNo;

                _mLIST.$el.pagination.hide().empty();
                if (_mLIST.dataPagination.active && (tP>1)){
                    //append previous
                    if(p>0){
                        _mLIST.$el.pagination.append('<li><a href="#" data-page="'+(p-1)+'">«</a></li>');
                    }
                    if(fP >= 0){
                        _mLIST.$el.pagination.append('<li class="disabled"><span>...</span></li>');
                    }else{
                        fP = 0;
                    }
                    //append pages handlers
                    for(i = fP; ((i <= lP) && (i < tP)); i++) {
                        _mLIST.$el.pagination.append('<li class="'+((i === p) ? 'active' : '')+'"><a href="#" data-page="'+i+'">'+(i+1)+'</a></li>');
                    }
                    if(lP <= tP){
                        _mLIST.$el.pagination.append('<li class="disabled"><span>...</span></li>');
                    }
                    //append next
                    if((p+1)<tP) {
                        _mLIST.$el.pagination.append('<li><a href="#" data-page="'+(p+1)+'">»</a></li>');
                    }
                    _mLIST.$el.pagination.show();
                    $("li a",_mLIST.$el.pagination)
                        .on('click', function(e){
                            e.preventDefault();
                            var reqAction = $(this).data("page");
                            _mLIST.repaintPagination(reqAction);
                            _mLIST.repaintList();
                        });
                }
            },
            getData: function (){ // populate/refresh data array
                var	lcl_postdata = {
                    "from": 0,
                    "to": 0,
                    "order": "none"
                };
                $.ajax({
                    type: "get",
                    url: baseRestApiURL + "workflow/?rnd=" + Math.random(),
//                    crossDomain: true,
                    dataType: "json",
//                    data: JSON.stringify(lcl_postdata),
                    contentType: "application/json; charset=utf-8",
                    headers: {
                        "Accept": "application/json",
                        "Content-Type": "application/json",
                        "Authorization": authHeader
                    },
                    error : function (jqXHR, textStatus, errorThrown) {
                        if(( jqXHR.status === 401 ) || ( jqXHR.status === 403 )){
                            alert('E001A, Not authenticated.');
                        } else {
                            alert('E001, An error has occurred, please try again or contact app admin.');
                        }
                    },
                    success: function(response,textStatus, jqXHR) {
                        if(jqXHR.status === 204){
                            showMsg("No workflows found.", "SUCCESS");
                            response = [];
                        }
                        showMsg("Workflows list successfully retrieved.", "SUCCESS");
                        //inject fake tags
                        var j = 0;
                        for (j = 0; j < response.length; j++){
                            response[j].tags = [];
                            if(Math.random()<.5){response[j].tags.push("Tag1");}
                            if(Math.random()<.5){response[j].tags.push("Tag2");}
                            if(Math.random()<.5){response[j].tags.push("Tag3");}
                            if(Math.random()<.5){response[j].tags.push("Tag4");}
                            if(Math.random()<.5){response[j].tags.push("Tag5");}
                            if(Math.random()<.5){response[j].tags.push("Tag6");}
                        }
                        //create tags
                        _mLIST.dataAllTags = [];
                        for (j = 0; j < response.length; j++){
                            _mLIST.dataAllTags = _mLIST.dataAllTags.concat(response[j].tags);
                        }
                        _mLIST.dataAllTags.sort();
                        _mLIST.dataAllTags = arrayDuplicateRemove(_mLIST.dataAllTags);

                        _mLIST.data = response;
                        _mLIST.dataFull = response;
//_mLIST.hideLoading();
                        routeLoading('hide');
                        //keep this order
                        _mLIST.repaintTags();
                        _mLIST.repaint();
                    }
                });
            },
            repaintList: function() {
                _mLIST.clearList();
                if(_mLIST.data.length > 1){
                    $('.box-header.empty').hide();
                    $('.box-header.not-empty').show();
                }else{
                    $('.box-header.empty').show();
                    $('.box-header.not-empty').hide();
                }
                var visibleItemsRange = {
                    first: _mLIST.dataPagination.currentPage*_mLIST.dataPagination.itemsOnPage,
                    last: _mLIST.dataPagination.currentPage*_mLIST.dataPagination.itemsOnPage+_mLIST.dataPagination.itemsOnPage
                };
                //put items no values
                _mLIST.$el.valItemFrom.html(visibleItemsRange.first+1);
                _mLIST.$el.valItemTo.html( ((visibleItemsRange.last<_mLIST.data.length))? visibleItemsRange.last : _mLIST.data.length);
                _mLIST.$el.valItemCount.html(_mLIST.data.length);
                $.each(_mLIST.data, function( index, value ) {
                    if(_mLIST.dataPagination.active){
                        if((index >= visibleItemsRange.first) && (index < visibleItemsRange.last)){
                            _mLIST.drawNode(value);
                        }
                    } else{
                        _mLIST.drawNode(value);
                    }
                });
            },
            clearList: function() {
                _mLIST.$el.itemsBox.empty();
            },
            drawNode: function(elX) {
                var elID = guid();
                var $elClone;
                var tags = "";
                if(prefferences.viewMode ==="grid"){
                    $elClone = $( "#node-master-template" ).clone();
                }else{
                    $elClone = $( "#node-master-template-list" ).clone();
                }
                $elClone.prop("id", "node-"+elID ).appendTo( _mLIST.$el.itemsBox ).data("dna", elX);
                for (var j = 0; j < elX.tags.length; j++){
                    tags+="<span>"+elX.tags[j]+"</span>";
                }
                $(".box-top-tags", $elClone).html(tags);
                $(".val-wnm", $elClone).html(elX.name);
                $(".val-wuser", $elClone).html(elX.userName);
                if(elX.created && (elX.created !== null) && (elX.created instanceof Array) ){
                    $(".val-wcdate", $elClone).text(elX.created[0]+"-"+elX.created[1]+"-"+elX.created[2]+" "+elX.created[3]+":"+elX.created[4]+":"+elX.created[5]);
                }else{
                    $(".val-wcdate", $elClone).text('creation date unknown');
                }
                $(".val-wvisibility", $elClone).html(elX.visibility);
                $(".val-wstatus", $elClone).html(elX.status);
                if(elX.path){
                    $(".val-wpath", $elClone).html(elX.path);
                }else{
                    $(".val-wpath", $elClone).html('unspecified');
                }
                if(elX.active){
                    $(".val-wactive", $elClone).html('yes');
                } else{
                    $(".val-wactive", $elClone).html('no');
                }




                $(".val-nnet", $elClone).html(elX.id);
                $(".val-version", $elClone).html("Version: "+elX.version);

                $(".val-copyright", $elClone).html("Copyright: "+elX.copyright);
                $(".val-d", $elClone).html(elX.description);
                $(".val-p", $elClone).html(elX.processorCount+"X");
                $(".val-m", $elClone).html(elX.memorySizeGB+'GB');
                $(".val-s", $elClone).html(elX.diskSpaceSizeGB+'GB');
                $(".only-v-"+elX.stat, $elClone).show();
                $(".box-bottom", $elClone).find(".span-muted").addClass("collapse");
                if(elX.active === false){
                    $elClone.addClass("disabled");
                }
                $elClone.fadeIn('slow');
                return true;
            },
            refreshSearch: function(){
                var q = _mLIST.$el.searchBox.val();
                if(q === ""){
                    _mLIST.$el.like.hide("fast");
                } else{
                    _mLIST.$el.like.show("fast");
                    $(".val-q", _mLIST.$el.like).html(q);
                }
            }
        };

    deleteProcessingComponentById = function(id){
        $.ajax({
            url: baseRestApiURL + "component/"+id+"/?rnd=" + Math.random(),
            dataType : 'json',
            type: 'DELETE',
            headers: {
                "Accept": "application/json",
                "Content-Type": "application/json",
                "Authorization": authHeader
            },
            error : function (jqXHR, textStatus, errorThrown) {
                console.log("error");
                if(jqXHR.status === 500 ){
                    showMsg("Unable to delete node. Please try again.", "ERROR");
                } else {
                    alert('An error has occurred, please try again or contact app admin.');
                }
            },
            success: function(data) {
                showMsg("Workflow successfully deleted.", "SUCCESS");
                _mLIST.refresh();
            }
        });
    };

    myModalNodesOpShow = function(operationid){
        var $modal = $("#myModalNodes");
        $(".modal-dialog",$modal).removeClass("modal-lg");
        var rm_contentUrl = '/_tao/rm_content/rm_blank.php';
        var rmContent = '';

        if(operationid === "trace-execution"){
            rm_contentUrl='./fragments/mock-traceprojectexecution.fragment.html';
        }
        if(operationid === "view-results"){
            $(".modal-dialog","#myModalProject").addClass("modal-lg");
            rm_contentUrl='./fragments/mock-viewprojectresults.fragment.html';
        }

        if(operationid === "view"){
            $(".modal-dialog",$modal).addClass("modal-lg");
        }
        if(operationid === "op-plus"){
            $(".modal-dialog",$modal).addClass("modal-lg");
            rm_contentUrl="./fragments/component-plus.fragment.html?" + Math.random();
        }
        if(operationid === "edit"){
            rm_contentUrl="./fragments/topology-edit.fragment.html?" + Math.random();
        }
        if(operationid === "delete"){
            $('#confirm-dialog').modal('confirm',{
                msg:"Are you sure you want to delete workflow: "+_mLIST.dataOpQueue[0].dna.label+"?",
                callbackConfirm: function() {
                    deleteProcessingComponentById(_mLIST.dataOpQueue[0].dna.id);
                },
                callbackCancel:function(){}
            });
            return;
        }
        if(operationid === "enable"){
            rm_contentUrl='';
        }
        if(operationid === "disable"){
            rm_contentUrl='';
        }

        $.ajax({
            url: rm_contentUrl,
            success: function(result) {
                rmContent = result;
            },
            async:   false
        });
        if(rmContent !== ''){
            $modal.find('.modal-dialog').html(rmContent);
        }else{
            alert("Must be an error! Could not retrive needed data from server.");
            return e.preventDefault();
        }
        $modal.modal('show');
    };
    //bind some actions to active elements
    _mLIST.$el.itemsBox
        .on('click', '.btn-action', function (e) {
            var action = $(this).data("action");
            var nodeDNA = $(this).closest("core-node-box").data("dna");
            _mLIST.dataOpQueue = [{
                "dna":nodeDNA,
                "action":action
            }];
            if(action == 'wf-edit'){
                $(".tao-async-wf").fadeIn("slow");
                document.getElementById('WorkflowBuilder').contentWindow.location.reload();
                $(".tao-async-ph").fadeOut("slow");
                $(".tao-async-mc").fadeOut("slow");
            }else {
                myModalNodesOpShow(action);
            }
        });


    _mLIST.$el.tags
        .on('click', 'span', function (e) {
            $(this).toggleClass("selected");
            var cST = $('span.selected',_mLIST.$el.tags).length;
            _mLIST.$el.valCountFilters.html(cST);
            if(cST>0){
                _mLIST.$el.valCountFilters.show("fast");
            }else{
                _mLIST.$el.valCountFilters.hide("fast");
            }
            _mLIST.repaint();
        });
    _mLIST.$el.searchBox
        .on('keyup', function(e){
            _mLIST.repaint();
            _mLIST.refreshSearch();
        });
    $(".clear-search").on("click", function(event){
        _mLIST.$el.searchBox.val("");
        _mLIST.repaint();
        _mLIST.refreshSearch();
    });

    _mLIST.$el.wrapp
        .on("click", '.btn-action[data-action="refresh"]', function(event){
            event.preventDefault();
            _mLIST.refresh();
        })
        .on("click", '.btn-master-tool', function(event){
            event.preventDefault();
            var action = $(this).data("action");
            if(action === "op-plus") myModalNodesOpShow(action);
            if(action === "op-filter"){
                if( _mLIST.$el.tags.is(":visible") ){
                    _mLIST.$el.tags.hide("fast");
                }else{
                    _mLIST.$el.tags.show("fast");
                }
            }
            if(action === "view-list"){
                prefferences.viewMode="list";
                _settings.createCookie("prefferences_viewMode","list");
                _mLIST.refresh();
            }
            if(action === "view-table"){
                prefferences.viewMode="grid";
                _settings.createCookie("prefferences_viewMode","grid");
                _mLIST.refresh();
            }
        });

    ///////////////////
    function tao_closeWorkflow() {
        $(".tao-async-wf").fadeOut("slow");
        $(".tao-async-ph").fadeIn("slow");
        $(".tao-async-mc").fadeIn("slow");
    }

    $( document ).ready(function() {
        console.log( "exec nodes panel ready!" );
        $("form.search-container").on("submit",function(e){
            e.preventDefault(e);
        });
        _mLIST.getData();
    });
    //# sourceURL=filename.js
</script>
