<style>
    .btn-action { padding: 0; border-radius: 5px; }
    img.previewLogo{width:60px;height:60px;border-radius:15px;background-color:white;padding:5px;box-shadow:3px 3px 5px 0 rgba(51, 51, 51, 0.12);border-bottom:2px solid #3c8dbc}
    #details-wf{display:flex; flex-direction:row; justify-content:space-between;overflow: hidden;}
    .image-wf{margin:0px 5px 5px 0px}
</style>
<!-- modal nodes op -->
<div id="myModalNodes" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<!-- modal nodes op -->

<!-- Content Workflow -->
<section id="tao-async-wf" class="content tao-async-wf collapse">
    <div class="row">
        <div class="col-md-12" id="wfIframeWrapper" style="line-height:0">
        </div>
    </div>
</section>
<!-- /Content Workflow -->

<!-- Content Header (Page header) -->
<section class="content-header tao-async-ph">
    <h1>Workflows <small>The list of user created <strong>graphs</strong> that consists in one or more connected <strong>processing modules</strong> that will produce a result.</small></h1>
    <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
        <li class="active">Workflows</li>
    </ol>
</section>
<!-- /Content Header (Page header) -->
<!-- Main content -->
<section class="content tao-async-mc">
    <div id="panel-topo-wrapper" class="row collapseX">
        <div class="col-md-12">
            <!-- Custom Tabs -->
            <div class="nav-tabs-custom">
                <ul class="nav nav-tabs visible-xs-block"> <!-- visible-xs-block -->
                    <li class="role-dropdown active">
                        <select id="selectUserPanel" name="selectUserPanel" class="form-control form-changepane" title="Select desired workflows view.">
                            <option class="role role-admin" value="active_nodes" data-target="#panel-nodes">Active workflows </option>
                            <option class="role role-admin" value="disabled_nodes" data-target="#panel-nodes">Inactive workflows</option>
                           <!-- <option class="role role-admin" value="system_nodes" data-target="#panel-nodes">System workflows</option> -->
                        </select>
                    </li>
                </ul>
                <ul class="nav nav-tabs hidden-xs">
                    <li class="role role-admin active"><a href="#panel-nodes" data-toggle="tab" data-action="active_nodes" aria-expanded="true">Active workflows</a></li>
                    <li class="role role-admin"><a href="#panel-nodes" data-toggle="tab" data-action="disabled_nodes" aria-expanded="false">Inactive workflows</a></li>
                    <!--<li class="role role-admin"><a href="#panel-nodes" data-toggle="tab" data-action="system_nodes" aria-expanded="false">System workflows</a></li>-->
                </ul>



                <div class="tab-content">
                    <div class="tab-pane active" id="panel-nodes">
                        <div class="row">
                            <div class="col-md-12" id="list-master-controls">
                                <div class="box-tools pull-left">
                                    <button class="btn btn-master-tool text-black" data-action="op-plus" data-toggle="tooltip" data-original-title="Add new workflow"><i class="fa fa-plus"></i></button>
                                </div>
                                <div class="box-tools pull-left">
                                    <button class="btn btn-master-tool text-black" data-action="op-filter" data-toggle="tooltip" data-original-title="Filter by tags"><i class="fa fa-filter"></i><span class="label label-warning val-count-filters" style="display:none;">0</span></button>
                                </div>
                                <div class="box-tools pull-left">
                                    <form class="search-container collapse" action="">
                                        <input id="search-box" type="text" class="search-box" name="q" placeholder="Search by label" />
                                        <label for="search-box"><i class="fa fa-search search-icon" aria-hidden="true"></i></label>
                                        <input type="submit" id="search-submit" />
                                    </form>
                                </div>
                                <div class="box-tools pull-right">
                                    <button class="btn btn-master-tool text-black" data-action="refresh-list" data-toggle="tooltip" data-original-title="Refresh"><i class="fa fa-refresh fa-spin-hover"></i></button>
                                    <button class="btn btn-master-tool text-black" data-action="view-list" data-toggle="tooltip" data-original-title="List view"><i class="fa fa-list"></i></button>
                                    <button class="btn btn-master-tool text-black" data-action="view-table" data-toggle="tooltip" data-original-title="Grid view"><i class="fa fa-table"></i></button>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 like collapse">
                                <span data-tag="tag">Label like: <strong class="val-q"></strong>&nbsp;<i class="fa fa-times fa-fw clear-search" aria-hidden="true"></i></span>
                            </div>
                            <div class="col-md-12 tags collapse">
                                <span class="collapse" data-tag="tag">tag<i class="fa fa-check fa-fw" aria-hidden="true"></i></span>
                            </div>
                        </div>
                        <div class="row" id="list-work-users">
                            <div class="col-sm-12">
                                <div class="box box-success">
                                    <div class="box-header">
                                        <i class="fa fa-random" aria-hidden="true"></i>
                                        <h3 class="box-title">Workflows -  <span class="val-itemfrom">0</span> to <span class="val-itemto">0</span> of <span class="val-itemscount">0</span></h3>
                                        <div class="box-tools pull-right nppaginatedcells-order collapse" data-toggle="tooltip" title="Change order"></div>
                                    </div>
                                    <div class="nppaginatedcells-empty callout callout-empty">
                                        <p>List is empty. <span class="results-empty">You do not have any workflows.</span><span class="filter-results-empty collapse">Your current selection returned no results.</span></p>
                                    </div>
                                    <div class="box-body chat users-box">
                                        <div class="nppaginatedcells-panel-body">
                                        </div>
                                        <div class="cell-templates collapse">
                                            <core-cell-list>
                                                <div class="col-md-12 proj-element">
                                                    

                                                    <div class="tranz01 nodes-item-core-box">
                                                        <div class="box-top-tags">
                                                        </div>
                                                        <div class="project-box-body">
                                                            <div class="box-top">
                                                                <div class="box-title"><span class="val-name"></span>   <i class="fa fa-random"></i></div>
                                                                <div class="box-subtitle" style="cursor:pointer">Owner:&nbsp;<strong><span class="val-userId"></span></strong></span></div>
                                                                <div class="box-text">
                                                                    Created: <strong><span class="val-created"></span></strong> | 
                                                                    Visibility: <strong><span class="val-visibility"></span></strong> | 
                                                                    Status: <strong><span class="val-status"></span></strong>
                                                                </div>
                                                                <div class="box-icon image-wf">
                                                                    <img src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" width="60" height="60">
                                                                </div>
                                                              
                                                            </div>
                                                            
                                                            <div class="collapse">
                                                                last edited on <span class="info-box-date-end val-edatep">00.00.0000</span>,
                                                                <span class="info-box-date-days">26 hours ago</span>, completed: <span class="info-box-completed">50%</span>
                                                                <span class="val-project-description">Description...</span>
                                                            </div>
                                                        </div><!-- /.info-box-content -->
                                                    
                                                        <div class="row">
                                                            <div class="col-xs-12 text-left">
                                                        <button class="btn btn-primary btn-list-view btn-sm btn-action btn-nodeop wf-edit-description" data-action="wf-edit-description" data-toggle="tooltip" data-original-title="Edit description">
                                                            <span class="value-dependent value-1 collapse">
                                                                <span class="fa-stack fa-lg">
                                                                    <i class="fa fa-circle fa-stack-2x text-green"></i>
                                                                    <i class="fa fa-pencil fa-stack-1x fa-inverse"></i>
                                                                </span>
                                                            </span>
                                                            <span class="value-dependent value-0 collapse">
                                                                <span class="fa-stack fa-lg">
                                                                    <i class="fa fa-pencil fa-stack-1x"></i>
                                                                    <i class="fa fa-ban fa-stack-2x text-danger"></i>
                                                                </span>
                                                            </span>
                                                            <span class="value-dependent value-default">
                                                                <span class="fa-stack fa-lg value-dependent value-default">
                                                                    <i class="fa fa-pencil"></i>
                                                                </span>
                                                            </span>
                                                        </button>
                                                        <button class="btn btn-primary  btn-list-view btn-sm btn-action btn-nodeop wf-edit-workflow" data-action="wf-edit-workflow" data-toggle="tooltip" data-original-title="Edit workflow">
                                                            <span class="value-dependent value-1 collapse">
                                                                <span class="fa-stack fa-lg">
                                                                    <i class="fa fa-circle fa-stack-2x text-green"></i>
                                                                    <i class="fa fa-paint-brush fa-stack-1x fa-inverse"></i>
                                                                </span>
                                                            </span>
                                                            <span class="value-dependent value-0 collapse">
                                                                <span class="fa-stack fa-lg">
                                                                    <i class="fa fa-paint-brush fa-stack-1x"></i>
                                                                    <i class="fa fa-ban fa-stack-2x text-danger"></i>
                                                                </span>
                                                            </span>
                                                            <span class="value-dependent value-default">
                                                                <span class="fa-stack fa-lg value-dependent value-default">
                                                                    <i class="fa fa-paint-brush"></i>
                                                                </span>
                                                            </span>
                                                        </button>
                                                        <button class="btn btn-primary btn-list-view btn-sm btn-action btn-nodeop op-5" data-action="wf-clone" data-toggle="tooltip" data-original-title="Clone workflow">
                                                            <span class="value-dependent value-1 collapse">
                                                                <span class="fa-stack fa-lg">
                                                                    <i class="fa fa-circle fa-stack-2x text-green"></i>
                                                                    <i class="fa fa-random fa-stack-1x fa-inverse"></i>
                                                                </span>
                                                            </span>
                                                            <span class="value-dependent value-0 collapse">
                                                                <span class="fa-stack fa-lg">
                                                                    <i class="fa-random fa-stack-1x"></i>
                                                                    <i class="fa fa-ban fa-stack-2x text-danger"></i>
                                                                </span>
                                                            </span>
                                                            <span class="value-dependent value-default">
                                                                <span class="fa-stack fa-lg value-dependent value-default">
                                                                    <i class="fa fa-random"></i>
                                                                </span>
                                                            </span>
                                                            <span class="label value-copies collapse bg-black"></span>
                                                        </button>
                                                        <button class="btn btn-primary  btn-list-view btn-sm btn-action btn-nodeop op-20" data-action="wf-start" data-toggle="tooltip" data-original-title="Start execution">
                                                            <span class="value-dependent value-1 collapse">
                                                                <span class="fa-stack fa-lg">
                                                                    <i class="fa fa-circle fa-stack-2x text-green"></i>
                                                                    <i class="fa fa-paper-plane fa-stack-1x fa-inverse"></i>
                                                                </span>
                                                            </span>
                                                             <span class="value-dependent value-0 collapse">
                                                                <span class="fa-stack fa-lg">
                                                                    <i class="fa fa-paper-plane fa-stack-1x"></i>
                                                                    <i class="fa fa-ban fa-stack-2x text-danger"></i>
                                                                </span>
                                                            </span>
                                                            <span class="value-dependent value-default">
                                                                <span class="fa-stack fa-lg value-dependent value-default">
                                                                    <i class="fa fa-paper-plane"></i>
                                                                </span>
                                                            </span>
                                                        </button>
                                                        <button class="btn btn-primary  btn-list-view btn-sm btn-action btn-nodeop op-6" data-action="wf-script" data-toggle="tooltip" data-original-title="Generate script">
                                                            <span class="value-dependent value-default">
                                                                <span class="fa-stack fa-lg value-dependent value-default">
                                                                    <i class="fa fa-code"></i>
                                                                </span>
                                                            </span>
                                                        </button>
                                                        <button class="btn btn-primary  btn-list-view btn-sm btn-action btn-nodeop op-6" data-action="wf-delete" data-toggle="tooltip" data-original-title="Delete current workflow">
                                                            <span class="value-dependent value-default">
                                                                <span class="fa-stack fa-lg value-dependent value-default">
                                                                    <i class="fa fa-trash-o"></i>
                                                                </span>
                                                            </span>
                                                        </button>
                                                        <button class="btn btn-primary btn-list-view btn-sm btn-action btn-nodeop" data-action="view-results" data-toggle="tooltip" data-original-title="Show execution results">
                                                            <span class="value-dependent value-default">
                                                                <span class="fa-stack fa-lg value-dependent value-default">
                                                                    <i class="fa fa-picture-o"></i>
                                                                </span>
                                                            </span>
                                                        </button>
                                                        <button class="btn btn-primary btn-list-view btn-sm btn-action btn-nodeop" data-action="trace-execution" data-toggle="tooltip" data-original-title="Trace execution">
                                                            <span class="value-dependent value-default">
                                                                <span class="fa-stack fa-lg value-dependent value-default">
                                                                    <i class="fa fa-road"></i>
                                                                </span>
                                                            </span>
                                                        </button>
                                                        <button class="btn btn-primary btn-list-view btn-sm btn-action btn-nodeop hidden" data-action="wf-unsubscribe" data-toggle="tooltip" data-original-title="Unsubscribe from workflow">
                                                            <span class="value-dependent value-default">
                                                                <span class="fa-stack fa-lg value-dependent value-default">
                                                                    <i class="fa fa-minus-circle"></i>
                                                                </span>
                                                            </span>
                                                        </button>
                                                        <button class="btn btn-primary btn-list-view btn-sm btn-action btn-nodeop hidden" data-action="wf-subscribe" data-toggle="tooltip" data-original-title="Subscribe to workflow">
                                                            <span class="value-dependent value-default">
                                                                <span class="fa-stack fa-lg value-dependent value-default">
                                                                    <i class="fa fa-plus-circle"></i>
                                                                </span>
                                                            </span>
                                                        </button>
                                                    </div>
                                                        </div>

                                                        </div><!-- /.info-box -->

                                                </div>
                                            </core-cell-list>

                                            <core-cell-grid>
                                                <div class="col-md-3 col-sm-6">
                                                    <div class="nodes-item-core-box">
                                                        <div class="box-top-tags">
                                                        </div>
                                                        <div class="box-top">
                                                            <div class="box-title"><span class="val-name" title></span></div>
                                                            <div class="box-subtitle" style="cursor:pointer">Owner:&nbsp;<strong><span class="val-userId"></span></strong></div>
                                                            <div id="details-wf">
                                                                <div>
                                                                    <div class="box-text">Created:&nbsp;<strong><span class="val-created"></span></strong></div>
                                                                    <div class="box-text">Visibility:&nbsp;<strong><span class="val-visibility"></span></strong></div>
                                                                    <div class="box-text">Status:&nbsp;<strong><span class="val-status"></span></strong></div>
                                                                </div>
                                                                <div class="box-icon"><i class="fa fa-random"></i></div>
                                                                <div class="image-wf">
                                                                    <img src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" width="60" height="60">
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="box-bottom with-line">
                                                            <div class="">
                                                                <button type="button" class="btn btn-primary btn-sm btn-flat btn-action btn-nodeop" data-action="wf-edit-description" data-toggle="tooltip" data-original-title="Edit description"><i class="fa fa-pencil fa-fw" aria-hidden="true"></i><span class="span-muted collapse">&nbsp;Edit</span></button>
                                                                <button type="button" class="btn btn-primary btn-sm btn-flat btn-action btn-nodeop" data-action="wf-edit-workflow" data-toggle="tooltip" data-original-title="Edit workflow"><i class="fa fa-paint-brush fa-fw" aria-hidden="true"></i><span class="span-muted collapse">&nbsp;Edit</span></button>
                                                                <button type="button" class="btn btn-primary btn-sm btn-flat btn-action btn-nodeop" data-action="wf-clone" data-toggle="tooltip" data-original-title="Clone workflow"><i class="fa fa-random fa-fw" aria-hidden="true"></i><span class="span-muted collapse">&nbsp;Clone</span></button>
                                                                <button type="button" class="btn btn-primary btn-sm btn-flat btn-action btn-nodeop" data-action="wf-start" data-toggle="tooltip" data-original-title="Start execution"><i class="fa fa-paper-plane fa-fw" aria-hidden="true"></i><span class="span-muted collapse">&nbsp;Start execution</span></button>
                                                                <button type="button" class="btn btn-primary btn-sm btn-flat btn-action btn-nodeop " data-action="wf-script" data-toggle="tooltip" data-original-title="Generate script"><i class="fa fa-code fa-fw" aria-hidden="true"></i><span class="span-muted collapse">&nbsp;Generate script</span></button>
                                                                <button type="button" class="btn btn-primary btn-sm btn-flat btn-action btn-nodeop " data-action="wf-delete" data-toggle="tooltip" data-original-title="Delete current workflow"><i class="fa fa-trash-o fa-fw" aria-hidden="true"></i><span class="span-muted collapse">&nbsp;Delete workflow</span></button>
                                                                <button type="button" class="btn btn-primary btn-sm btn-flat btn-action btn-nodeop" data-action="view-results" data-toggle="tooltip" data-original-title="Show execution results"><i class="fa fa-picture-o fa-fw" aria-hidden="true"></i><span class="span-muted collapse">&nbsp;Show execution results</span></button>
                                                                <button type="button" class="btn btn-primary btn-sm btn-flat btn-action btn-nodeop" data-action="trace-execution" data-toggle="tooltip" data-original-title="Trace execution"><i class="fa fa-road fa-fw" aria-hidden="true"></i><span class="span-muted collapse">&nbsp;Trace execution</span></button>
                                                                <button type="button" class="btn btn-primary btn-sm btn-flat btn-action btn-nodeop hidden" data-action="wf-unsubscribe" data-toggle="tooltip" data-original-title="Unsubscribe from workflow" disabled><i class="fa fa-minus-circle fa-fw" aria-hidden="true"></i><span class="span-muted collapse">&nbsp;Unsubscribe from workflow</span></button>
                                                                <button type="button" class="btn btn-primary btn-sm btn-flat btn-action btn-nodeop hidden" data-action="wf-subscribe" data-toggle="tooltip" data-original-title="Subscribe to workflow" disabled><i class="fa fa-plus-circle fa-fw" aria-hidden="true"></i><span class="span-muted collapse">&nbsp;Subscribe to workflow</span></button>
                                                                
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </core-cell-grid>
                                        </div>
                                    </div>
                                    <div class="box-footer clearfix no-border">
                                        <div class="box-tools pull-right">
                                            <ul class="nppaginatedcells-panel-pagination pagination pagination-sm inline">
                                                <li><a href="#" data-page="prev">«</a></li>
                                                <li class="active"><a href="#" data-page="0">1</a></li>
                                                <li><a href="#" data-page="1">2</a></li>
                                                <li><a href="#" data-page="2">3</a></li>
                                                <li><a href="#" data-page="next">»</a></li>
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="box-notification"><p><span>List updated</span></p></div>
                                </div>
                            </div>
                        </div>
                    </div><!-- /.tab-pane -->

                </div><!-- /.tab-content -->
            </div><!-- nav-tabs-custom -->
        </div>
    </div>
</section><!-- /.content -->
<script>
    var username, timeoutId, userguid;
    var clicking = false;

    tao_showWorkflow = function(currentWfID){
        $(".tao-async-ph, .tao-async-mc").fadeOut("slow").promise().done(function() {
            var iH = $(".content-wrapper").innerHeight() || 1080;
            console.log("builder height:"+iH);
            var parentIframe = document.getElementById("wfIframeWrapper");
            var iframe = document.createElement('iframe');
            iframe.id = "WorkflowBuilder"+Math.floor(Math.random() * 10000000);
            iframe.src = './workflow/index.html?_wf='+currentWfID;
            iframe.title="WorkflowBuilder";
            iframe.style.margin = "0";
            iframe.style.width = "100%";
            iframe.style.height = iH+"px";
            iframe.style.border = "0";
            iframe.scrolling="no";
            while (parentIframe.hasChildNodes()) {
                parentIframe.removeChild(parentIframe.lastChild);
            }
            parentIframe.appendChild(iframe);
            $(".tao-async-wf").fadeIn("slow");
        });
        history.pushState(null, null, "#my/workflows::edit="+currentWfID+"|page=0");
        return 1;
    };
    tao_closeWorkflow = function(){
        $(".tao-async-wf").fadeOut("slow");
        $(".tao-async-ph").fadeIn("slow");
        $(".tao-async-mc").fadeIn("slow");
        history.pushState(null, null, "#my/workflows");
    };

    cloneWorkflowById = function(id){
        var cloneWf = $.ajax({
            cache: false,
            url: baseRestApiURL + "workflow/clone?workflowId="+id,
            type: 'POST',
            headers: {
                "Accept": "application/json",
                "Content-Type": "application/json",
                "X-Auth-Token": window.tokenKey
            }
        });
        $.when(cloneWf)
            .done(function (cloneWfResponse) {
                var r = chkTSRF(cloneWfResponse);
                if(r.id){
                    showMsg("Workflow successfully cloned. Workflow <i>"+r.name+"</i> created in your workspace.", "SUCCESS");
                    panelComp.refreshData();
                }else{
                    showMsg("Workflow clone failed. " + (typeof cloneWfResponse.message !== 'undefined' ? cloneWfResponse.message : ''), "ERROR");
                }
            })
            .fail(function (jqXHR, textStatus, errorThrown) {
                showMsg("Workflow clone failed. " + errorThrown, "ERROR");
            });
    };

    deleteWorkflowById = function(id){
        var deleteWf = $.ajax({
            cache: false,
            url: baseRestApiURL + "workflow/"+id+"/",
            type: 'DELETE',
            headers: {
                "Accept": "application/json",
                "Content-Type": "application/json",
                "X-Auth-Token": window.tokenKey
            }
        });
        $.when(deleteWf)
            .done(function (deleteWfResponse) {
                if(deleteWfResponse && (deleteWfResponse.status ==="SUCCEEDED")){
                    showMsg("Workflow deleted", "SUCCESS");
                    panelComp.refreshData();
                }else{
                    showMsg("Workflow deletion failed. "  + (typeof deleteWfResponse.message !== 'undefined' ? deleteWfResponse.message : ''), "ERROR");
                }
            })
            .fail(function (jqXHR, textStatus, errorThrown) {
                showMsg("Workflow delete failed. " + errorThrown, "ERROR");
            });
        return 1;
    };
    
    unsubscribeWorkflow = function(userId, workflowId){
        var unsubWf = $.ajax({
            cache: false,
            url: baseRestApiURL + "workflow/unsubscribe?userId=" + userId + "&workflowId=" + workflowId,
            type: 'POST',
            headers: {
                "Accept": "application/json",
                "Content-Type": "application/json",
                "X-Auth-Token": window.tokenKey
            }
        });
        $.when(unsubWf)
            .done(function (unsubWorkflowResponse) {
                if(unsubWorkflowResponse && (unsubWorkflowResponse.status === "SUCCEEDED")){
                    showMsg("Workflow succesfully unsubscribed", "SUCCESS");
                    panelComp.refreshData();
                }else{
                    showMsg("Workflow unsubscribe failed. " + (typeof unsubscribeWorkflow.message !== 'undefined' ? unsubscribeWorkflow.message : ''), "ERROR");
                }
            })
            .fail(function (jqXHR, textStatus, errorThrown) {
                showMsg("Workflow unsubscribe failed. " + errorThrown, "ERROR");
            });
    };

    subscribeWorkflow = function(userId, workflowId){
        var subWf = $.ajax({
            cache: false,
            url: baseRestApiURL + "workflow/subscribe?userId=" + userId + "&workflowId=" + workflowId,
            type: 'POST',
            headers: {
                "Accept": "application/json",
                "Content-Type": "application/json",
                "X-Auth-Token": window.tokenKey
            }
        });
        $.when(subWf)
            .done(function (subWorkflowResponse) {
                if(subWorkflowResponse && (subWorkflowResponse.status === "SUCCEEDED")){
                    showMsg("Workflow succesfully subscribed", "SUCCESS");
                    panelComp.refreshData();
                }else{
                    showMsg("Workflow subscribe failed. " + (typeof subscribeWorkflow.message !== 'undefined' ? subscribeWorkflow.message : ''), "ERROR");
                }
            })
            .fail(function (jqXHR, textStatus, errorThrown) {
                showMsg("Workflow subscribe failed. " + errorThrown, "ERROR");
            });
    };

    myModalNodesOpShow = function(operationid, args){
        var $modal = $("#myModalNodes");
        $(".modal-dialog",$modal).removeClass("modal-lg");
        var rm_contentUrl = '';
        var rmContent = '';
        window.userOpStack = [];

        if(operationid === "trace-execution"){
            window.userOpStack = [{
                "dna":args.dna,
                "action":"wf_edit"
            }];
            rm_contentUrl='./fragments/workflow-trace-executions.fragment.html';
        }

        if(operationid === "view-results"){
            window.userOpStack = [{
                "dna":args.dna,
                "action":"wf_edit"
            }];
            $(".modal-dialog","#myModalProject").addClass("modal-lg");
            rm_contentUrl='./fragments/workflow-show-results.fragment.html';
        }

        if(operationid === "wf-start"){
            window.userOpStack = [{
                "dna":args.dna,
                "action":"wf_edit"
            }];
            $(".modal-dialog",$modal).addClass("modal-lg");
            rm_contentUrl="./fragments/workflow-start.fragment.html?" + Math.random();
        }

        if(operationid === "wf-script"){
            window.userOpStack = [{
                "dna":args.dna,
                "action":"wf_script"
            }];
            $(".modal-dialog",$modal).addClass("modal-lg");
            rm_contentUrl='./fragments/workflow-start.fragment.html?' + Math.random();
        }

        if(operationid === "op-plus"){
            $(".modal-dialog",$modal).addClass("modal-lg");
            rm_contentUrl="./fragments/workflow-plus.fragment.html?" + Math.random();
        }
        if(operationid === "wf-edit-description"){
            window.userOpStack = [{
                "dna":args.dna,
                "action":"wf_edit"
            }];
            $(".modal-dialog",$modal).addClass("modal-lg");
            rm_contentUrl="./fragments/workflow-plus.fragment.html?" + Math.random();
        }

        if(rm_contentUrl === ''){
            alert("AVL - Operation mismatch");
            return;
        }
        $.ajax({
            url: rm_contentUrl,
            success: function(result) {
                rmContent = result;
                if(rmContent !== ''){
                    $modal.find('.modal-dialog').html(rmContent);
                }else{
                    alert("Could not retrive needed data from server.");
                    return e.preventDefault();
                }
                $modal.modal('show');
            }
        });
    };

    function getUsername(guid){
        var getName = $.ajax({
            cache: false,
            url: baseRestApiURL + "user/name/" + guid,
            type: 'GET',
            headers: {
                "Accept": "application/json",
                "Content-Type": "application/json",
                "X-Auth-Token": window.tokenKey
            }
        });

        $.when(getName).done(function (response) {
            if(response.status === "SUCCEEDED" && typeof response.data !== "undefined"){
                username = response.data;
            }else{
                username = guid;
                showMsg("Could not retrieve username.", response.status);
            }
        }).fail(function () {
        });
    }

	/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    $( document ).ready(function(e) {
        //window.parent.$(window.parent.document).on("my-event", function(){ alert("done");});

        if(routeTags[0]==="shared"){
            $el=$("section.tao-async-ph");
            $el.find("h1").html("Shared Workflows<small>List of <strong>shared workflows</strong> availlable to all usesrs.</small>");
            $el.find("li.active").html("Shared workflows");

            $(".btn-nodeop",".cell-templates").hide();
            $(".btn-nodeop[data-action='wf-edit-workflow'],.btn-nodeop[data-action='wf-start'],.btn-nodeop[data-action='wf-clone'] ",".cell-templates").show();
        }

        var urls = [
            baseRestApiURL + "workflow/"
        ];
		
		
		window.panelComp = $("#panel-nodes").npPaginatedCells({
			headerUser: taoUserProfile.username,
			url: urls,
			viewMode: preferences.viewMode,
			filterAttribute: "name",
			order:[
				{
					"label":"Name ascending",
					"objAttributeName":"name",
					"direction":"ASC"
				},
				{
					"label":"Name descending",
					"objAttributeName":"name",
					"direction":"DSC"
				},
				{
					"label":"Date ascending",
					"objAttributeName":"created",
					"direction":"ASC"
				},
				{
					"label":"Date descending",
					"objAttributeName":"created",
					"direction":"DSC"
				}
			],
			doAction: function(action, args){
				if(action === "op-plus"){
					//if( taoUserProfile.userRole !== "ADMIN"){
					//	showMsg("Only admin roles can ad components to the shared workspace. You should try adding components to your own workspace", "ERROR");
					//	return;
					//}
					myModalNodesOpShow(action, args);
				}

				if((action === "wf-edit-description") || (action === "trace-execution") || (action === "view-results") || (action === "wf-start") || (action === "wf-script"))
					myModalNodesOpShow(action, args);

				if(action === 'wf-edit-workflow'){
                    /*if(taoUserProfile.userRole !== "ADMIN" && taoUserProfile.username !== args.dna.userName){
                        return;
                    }*/
                    tao_showWorkflow(args.dna.id);
                }

				if(action === 'wf-clone') cloneWorkflowById(args.dna.id);

				if(action === 'wf-unsubscribe') unsubscribeWorkflow(taoUserProfile.id, args.dna.id);

				if(action === 'wf-subscribe') subscribeWorkflow(taoUserProfile.id, args.dna.id);

				if(action === "wf-delete"){
					if( taoUserProfile.userRole !== "ADMIN" && taoUserProfile.username !== args.dna.userName ){
						alert("not allowed");
						return;
					}
					$('#confirm-dialog').modal('confirm',{
						msg:"Are you sure you want to delete workflow <strong>"+args.dna.name+"</strong>?",
						callbackConfirm: function() {
							deleteWorkflowById(args.dna.id);
						},
						callbackCancel:function(){}
					});
				}
			},
            doCustomRender: function($elClone, elX){
                if((elX.status ==='PUBLISHED'  && (elX.visibility ==='PUBLIC' || elX.visibility ==='SUBSCRIPTION')) || !elX.active){
                    var isAdmin = taoUserProfile.userRole === "ADMIN";
                    $elClone.find("[data-action=wf-edit-description]").prop("disabled", !isAdmin);
                    $elClone.find("[data-action=wf-edit-workflow]").prop("disabled",true);
                    $elClone.find("[data-action=wf-script]").prop("disabled",true);
                    $elClone.find("[data-action=wf-delete]").prop("disabled",true);
                    $elClone.find("[data-action=view-results]").prop("disabled",true);
                    $elClone.find("[data-action=trace-execution]").prop("disabled",true);

                    if(elX.visibility ==='SUBSCRIPTION'){
                        $elClone.find("[data-action=wf-edit-description]").prop("disabled", true);
                        $elClone.find("[data-action=wf-unsubscribe]").removeClass("hidden");
                        $elClone.find("[data-action=wf-unsubscribe]").prop("disabled",false);
                    }

                    // if(elX.status ==='PUBLISHED' && elX.active){
                    //     $elClone.find("[data-action=wf-subscribe]").removeClass("hidden");
                    //     $elClone.find("[data-action=wf-subscribe]").prop("disabled",false);
                    // }

                    // when element is not active disable all buttons
					if (!elX.active) {
						$elClone.find("[data-action=wf-clone]").prop("disabled",true);
						$elClone.find("[data-action=wf-start]").prop("disabled",true);
					}
                }

                // if has image, it display it
                if(typeof elX.image !== "undefined"){
                    $elClone.find(".image-wf").empty();
                    $elClone.find(".image-wf").append("<img class=\"previewLogo\" alt=\"\" />");
                    $(".previewLogo", $elClone).attr("src", "data:image/jpeg;base64, " + elX.image);
                    $(".box-icon .fa-random", $elClone).remove();
                }

                $(".box-subtitle", $elClone).on('mousedown', function() {
                    clicking = true;
                    userguid = $elClone.data('dna').userId;
                    getUsername(userguid);

                    timeoutId = setTimeout(function(){
                        $elClone.find(".val-userId").text(username);
                    }, 500);
                }).on('mouseup mouseleave', function() {
                    if(clicking === true){
                        $elClone.find(".val-userId").text(userguid);
                        clearTimeout(timeoutId);
                        clicking = false;
                    }
                });
            }
        });
        
		$("#selectUserPanel").on("change", function () {
			var current_pane = $(this).val() || 0;
            $("a[data-action='" + current_pane +"']",'.nav-tabs-custom').trigger( "click" );
		});
		
		$("a[data-toggle='tab']", ".nav-tabs-custom").on("click", function () {
			window.panelComp.refreshData(baseRestApiURL);
		});

    });
    //# sourceURL=workflows-admin2.fragment.js
</script>
